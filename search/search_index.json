{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Vault File Encryption","text":"<p>This application is an MVP that watches directories for files, encrypts them using HashiCorp Vault Transit Engine with envelope encryption, and stores the encrypted files in a separate folder. Works with both HCP Vault (cloud) and Vault Enterprise (self-hosted).</p> <p>[!WARNING] v1.0.0 Breaking Changes: This version introduces a new encrypted file format using the <code>go-fileencrypt</code> library. Files encrypted with previous versions are not compatible. See MIGRATION_GUIDE.md for upgrade instructions.</p>"},{"location":"#high-level-overview","title":"High-Level Overview","text":"<pre><code>graph TD\n    subgraph Inputs\n        FW[File Watcher]\n        CLI[CLI]\n    end\n\n    FW --&gt;|Service Mode| Q[FIFO Queue]\n    Q --&gt; PROC[Processor]\n    CLI --&gt;|CLI Mode| PROC\n\n    PROC --&gt; VA[Vault Agent&lt;br/&gt;local listener]\n    VA --&gt; VTE[Vault Transit&lt;br/&gt;Engine]</code></pre>"},{"location":"#encryption-flow","title":"Encryption Flow","text":"<ol> <li>File appears in source directory</li> <li>Watcher detects and queues file</li> <li>Processor generates data key via Vault</li> <li>File encrypted with AES-256-GCM using data key</li> <li>Data key encrypted with Vault Transit key</li> <li>Encrypted file and key saved to destination</li> <li>Original file archived or deleted</li> </ol>"},{"location":"#workflow-diagram","title":"Workflow Diagram","text":"<p>The diagram below shows both the continuous Service Mode path (through watcher + queue) and the one-off CLI Mode path (direct to processor). The processor handles both encryption and decryption via strategy pattern. Re-wrap and key version audit operations are shown separately as they only work with <code>.key</code> files.</p> <pre><code>flowchart TB\n  subgraph ServiceMode[Service Mode - watch]\n    SRC[\"Source Directory (plaintext for encryption or .enc+.key pairs for decryption)\"]\n    SRC --&gt; W[File Watcher fsnotify + startup scan]\n    W --&gt; D[Stability Check size settle detection]\n    D --&gt; Q[FIFO Queue retries + persistence]\n  end\n\n  subgraph CLIMode[CLI Mode - one-off]\n    CLI[\"CLI Command encrypt | decrypt\"]\n  end\n\n  Q --&gt; PROC\n  CLI --&gt; PROC\n\n  PROC[Processor strategy: Encrypt or Decrypt]\n\n  PROC --&gt;|Encryption| ENC_FLOW{Encryption Flow}\n  PROC --&gt;|Decryption| DEC_FLOW{Decryption Flow}\n\n  ENC_FLOW --&gt;|1. Request DEK| V1[(Vault Transit/datakey/plaintext)]\n  V1 --&gt;|plaintext + ciphertext DEK| ENC_FLOW\n  ENC_FLOW --&gt;|2. Encrypt with DEK| ENC_OUT[\"Output Files\"]\n  ENC_OUT --&gt; ENC_FILE[\"file.enc AES-256-GCM chunks\"]\n  ENC_OUT --&gt; KEY_FILE[\"file.key ciphertext DEK\"]\n  ENC_OUT --&gt;|optional| HASH_FILE[\"file.sha256 checksum\"]\n\n  DEC_FLOW --&gt;|1. Read ciphertext DEK| KEY_FILE\n  DEC_FLOW --&gt;|2. Decrypt DEK| V2[(Vault Transit/decrypt)]\n  V2 --&gt;|plaintext DEK| DEC_FLOW\n  DEC_FLOW --&gt;|3. Decrypt file| PLAIN[\"file plaintext\"]\n\n  ENC_FILE -.-&gt;|becomes source for decryption| SRC\n  KEY_FILE -.-&gt;|paired with .enc| SRC\n\n  PROC --&gt;|Success| CLEANUP[Post-Process archive or delete originals]\n\n  subgraph KeyMaint[Key Maintenance - separate operations]\n    REWRAP[rewrap command rotate to newer key version]\n    AUDIT[key-versions command offline audit, no Vault]\n  end\n\n  REWRAP --&gt;|read| KEY_FILE\n  REWRAP --&gt;|call| V3[(Vault Transit/rewrap)]\n  V3 --&gt;|update| KEY_FILE\n  AUDIT --&gt;|read only| KEY_FILE\n\n  classDef vault fill:#502d7f,stroke:#333,stroke-width:2px,color:#fff;\n  class V1,V2,V3 vault;\n\n  classDef files fill:#0b5d8a,stroke:#0b5d8a,stroke-width:2px,color:#fff;\n  class ENC_FILE,KEY_FILE,HASH_FILE,PLAIN files;\n\n  classDef process fill:#176c3a,stroke:#0b4a26,stroke-width:2px,color:#fff;\n  class PROC,Q,W,D,CLEANUP process;\n\n  classDef decision fill:#d97706,stroke:#92400e,stroke-width:2px,color:#fff;\n  class ENC_FLOW,DEC_FLOW decision;\n\n  classDef cli fill:#aa5a00,stroke:#6d3a00,stroke-width:2px,color:#fff;\n  class CLI,REWRAP,AUDIT cli;</code></pre> <p>Key points: - Service Mode always passes through the watcher and queue, ensuring ordering, retries, and persistence. - CLI Mode bypasses watcher/queue for immediate single-file processing. - <code>.key</code> files store only ciphertext DEKs; plaintext keys never hit disk. - Re-wrap updates <code>.key</code> files to newer Vault key versions without touching <code>.enc</code> data. - Key version auditing (<code>key-versions</code>) runs offline (no Vault calls).</p>"},{"location":"#features","title":"Features","text":"<ul> <li>File System Watching: Automatic detection of new files with <code>fsnotify</code></li> <li>Envelope Encryption: Uses Vault Transit Engine for secure key management</li> <li>Bidirectional: Support for both encryption and decryption modes</li> <li>Progress Logging: Real-time progress updates every 20%</li> <li>Retry Logic: FIFO queue with exponential backoff</li> <li>Integrity Verification: Optional SHA256 checksum validation</li> <li>Hot Reload: Configuration changes without restart (SIGHUP on Unix)</li> <li>Enhanced Security (via <code>go-fileencrypt</code>): </li> <li>Constant-time memory zeroing (prevents compiler optimization)</li> <li>Memory locking (prevents key swapping to disk)</li> <li>Authenticated encryption with AES-256-GCM</li> <li>Secure, versioned file format with magic headers and salt</li> <li>Chunk size validation (prevents DOS attacks)</li> <li>Cross-Platform: Binaries for macOS, Windows, Linux (64-bit)</li> <li>Comprehensive Logging: Plaintext or JSON format with audit support</li> <li>CLI Mode: One-off encryption/decryption operations</li> <li>Configurable Chunk Size: Optimize encryption for file size (64KB-10MB)</li> <li>Key Re-wrapping: Rotate encrypted DEKs to newer Vault key versions without re-encrypting data</li> <li>Flexible Vault Authentication: Multiple auth methods supported - Token, AppRole, Kubernetes, JWT, TLS Certificate, or using Vault Agent</li> </ul>"},{"location":"#table-of-contents","title":"Table of Contents","text":"<ul> <li>Prerequisites</li> <li>Quick Start</li> <li>Installation</li> <li>Configuration</li> <li>Usage</li> <li>Architecture</li> <li>Contributing</li> <li>License</li> </ul>"},{"location":"#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.25.0+ (for building from source)</li> <li>Vault: One of the following:</li> <li>HCP Vault cluster with Transit Engine enabled, OR</li> <li>Vault Enterprise (or Community Edition) for local development</li> <li>Authentication: Choose one of:</li> <li>Vault Agent (recommended for production) - handles authentication automatically</li> <li>Direct authentication - Token, AppRole, Kubernetes, JWT, or TLS Certificate</li> <li>See Vault Authentication section for configuration details</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#1-build-the-application","title":"1. Build the Application","text":"<pre><code>git clone https://github.com/gitrgoliveira/vault-file-encryption.git\ncd vault-file-encryption\nmake build\n</code></pre>"},{"location":"#2-set-up-vault","title":"2. Set Up Vault","text":"<p>Choose your Vault deployment:</p> <p>Option A: HCP Vault (Cloud) <pre><code># Follow the HCP Vault setup guide\n# See: guides/VAULT_SETUP_GUIDE.md\ncd scripts/vault-setup\nterraform init\nterraform apply\n</code></pre></p> <p>Option B: Vault Enterprise (Local Dev Mode) <pre><code># Follow the Vault Enterprise setup guide\n# See: guides/VAULT_ENTERPRISE_SETUP_GUIDE.md\ncd scripts/vault-setup-enterprise\n./01-start-vault-dev.sh    # Terminal 1\n./02-configure-vault.sh    # Terminal 2\n</code></pre></p>"},{"location":"#3-start-vault-agent","title":"3. Start Vault Agent","text":"<p>For HCP Vault: <pre><code># Unix/Linux/macOS\nvault agent -config=https://github.com/gitrgoliveira/vault-file-encryption/blob/main/configs/vault-agent/vault-agent-hcp-token.hcl\n</code></pre></p> <pre><code># Windows\nvault agent -config=configs\\vault-agent\\vault-agent-hcp-token.hcl\n</code></pre> <p>For Vault Enterprise: <pre><code># Unix/Linux/macOS\nvault agent -config=https://github.com/gitrgoliveira/vault-file-encryption/blob/main/configs/vault-agent/vault-agent-enterprise-dev.hcl\n</code></pre></p> <pre><code># Windows\nvault agent -config=configs\\vault-agent\\vault-agent-enterprise-dev.hcl\n</code></pre>"},{"location":"#4-encrypt-a-file-cli-mode","title":"4. Encrypt a File (CLI Mode)","text":"<p>HCP Vault: <pre><code># Unix/Linux/macOS\n./bin/file-encryptor encrypt \\\n  -i myfile.txt \\\n  -o myfile.txt.enc \\\n  -c https://github.com/gitrgoliveira/vault-file-encryption/blob/main/configs/examples/example.hcl\n</code></pre></p> <pre><code># Windows\n.\\bin\\file-encryptor-windows-amd64.exe encrypt `\n  -i myfile.txt `\n  -o myfile.txt.enc `\n  -c configs\\examples\\example.hcl\n</code></pre> <p>Vault Enterprise: <pre><code># Unix/Linux/macOS\n./bin/file-encryptor encrypt \\\n  -i myfile.txt \\\n  -o myfile.txt.enc \\\n  -c https://github.com/gitrgoliveira/vault-file-encryption/blob/main/configs/examples/example-enterprise.hcl\n</code></pre></p> <pre><code># Windows\n.\\bin\\file-encryptor-windows-amd64.exe encrypt `\n  -i myfile.txt `\n  -o myfile.txt.enc `\n  -c configs\\examples\\example-enterprise.hcl\n</code></pre> <p>This creates: - <code>myfile.txt.enc</code> - Encrypted file - <code>myfile.txt.key</code> - Encrypted data key</p>"},{"location":"#5-run-service-mode-watch-directories","title":"5. Run Service Mode (Watch Directories)","text":"<pre><code># Unix/Linux/macOS\n./bin/file-encryptor watch -c https://github.com/gitrgoliveira/vault-file-encryption/blob/main/configs/examples/example.hcl\n</code></pre> <pre><code># Windows (hot-reload not available - restart to reload config)\n.\\bin\\file-encryptor-windows-amd64.exe watch -c configs\\examples\\example.hcl\n</code></pre> <p>The service will: - Scan and process any pre-existing files in configured directories on startup - Monitor configured directories for new files (using fsnotify) - Queue files for processing with retry logic - Encrypt/decrypt files automatically - Save queue state on shutdown</p>"},{"location":"#installation","title":"Installation","text":""},{"location":"#download-pre-built-binaries","title":"Download Pre-built Binaries","text":"<p>Download the latest release for your platform from the Releases page:</p> <ul> <li>Windows (64-bit): <code>file-encryptor-windows-amd64.exe</code></li> <li>macOS (64-bit): <code>file-encryptor-darwin-amd64</code></li> <li>Linux (64-bit): <code>file-encryptor-linux-amd64</code></li> </ul>"},{"location":"#build-from-source","title":"Build from Source","text":"<p>Prerequisites: - Go 1.25.0 or later - Make (Unix/Linux/macOS) or use <code>go build</code> directly on Windows</p> <pre><code># Unix/Linux/macOS\ngit clone https://github.com/gitrgoliveira/vault-file-encryption.git\ncd vault-file-encryption\nmake build\n\n# Build for all platforms\nmake build-all\n</code></pre> <pre><code># Windows (using Git Bash or WSL for Make)\ngit clone https://github.com/gitrgoliveira/vault-file-encryption.git\ncd vault-file-encryption\nmake build-windows\n\n# Or build directly with go\ngo build -o bin\\file-encryptor.exe cmd/file-encryptor/main.go\n</code></pre>"},{"location":"#configuration","title":"Configuration","text":""},{"location":"#example-configuration","title":"Example Configuration","text":"<p>See <code>https://github.com/gitrgoliveira/vault-file-encryption/blob/main/configs/examples/example.hcl</code> for a complete configuration example.</p>"},{"location":"#minimal-configuration","title":"Minimal Configuration","text":"<pre><code>vault {\n  agent_address = \"http://127.0.0.1:8200\"\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n}\n\nencryption {\n  source_dir = \"/data/source\"\n  dest_dir = \"/data/encrypted\"\n  source_file_behavior = \"archive\"\n  chunk_size = \"2MB\"  # Optional: 64KB-10MB, default 1MB\n}\n\nqueue {\n  state_path = \"/var/lib/file-encryptor/queue-state.json\"\n}\n\nlogging {\n  level = \"info\"\n  output = \"stdout\"\n}\n</code></pre>"},{"location":"#vault-authentication","title":"Vault Authentication","text":"<p>The application supports multiple Vault authentication methods. Choose the approach that best fits your deployment:</p> <ul> <li>Vault Agent (recommended) - Automatic authentication, no config needed</li> <li>Direct Authentication - Token, AppRole, Kubernetes, JWT, or TLS Certificate</li> </ul>"},{"location":"#option-1-vault-agent-recommended","title":"Option 1: Vault Agent (Recommended)","text":"<p>Vault Agent handles authentication automatically. Simply point to the agent's listener:</p> <pre><code>vault {\n  agent_address = \"http://127.0.0.1:8200\"  # Vault Agent listener\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n  # No auth block needed\n}\n</code></pre>"},{"location":"#option-2-direct-authentication","title":"Option 2: Direct Authentication","text":"<p>For environments without Vault Agent, configure one of the following methods:</p>"},{"location":"#token-authentication","title":"Token Authentication","text":"<p>Use case: Development and testing only</p> <p>Configuration: <pre><code>vault {\n  agent_address = \"https://vault.example.com:8200\"\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n\n  auth {\n    method = \"token\"\n    token {\n      token = \"hvs.CAES...\"  # Or set VAULT_TOKEN env var\n    }\n  }\n}\n</code></pre></p> <p>Environment variables: - <code>VAULT_TOKEN</code> - Vault token - <code>VAULT_NAMESPACE</code> - Vault namespace (optional)</p>"},{"location":"#approle-authentication","title":"AppRole Authentication","text":"<p>Use case: Production applications and services</p> <p>Configuration: <pre><code>vault {\n  agent_address = \"https://vault.example.com:8200\"\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n\n  auth {\n    method = \"approle\"\n    approle {\n      role_id = \"your-role-id\"      # Or set VAULT_ROLE_ID env var\n      secret_id = \"your-secret-id\"  # Or set VAULT_SECRET_ID env var\n      mount_path = \"auth/approle\"   # Optional, defaults to \"auth/approle\"\n    }\n  }\n}\n</code></pre></p> <p>Environment variables: - <code>VAULT_ROLE_ID</code> - AppRole role ID - <code>VAULT_SECRET_ID</code> - AppRole secret ID</p>"},{"location":"#kubernetes-authentication","title":"Kubernetes Authentication","text":"<p>Use case: Kubernetes deployments</p> <p>Configuration: <pre><code>vault {\n  agent_address = \"https://vault.example.com:8200\"\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n\n  auth {\n    method = \"kubernetes\"\n    kubernetes {\n      role = \"file-encryptor\"\n      token_path = \"/var/run/secrets/kubernetes.io/serviceaccount/token\"  # Optional\n      mount_path = \"auth/kubernetes\"  # Optional\n    }\n  }\n}\n</code></pre></p> <p>Environment variables: None (uses service account token file)</p>"},{"location":"#jwt-authentication","title":"JWT Authentication","text":"<p>Use case: CI/CD pipelines, OIDC providers</p> <p>Configuration: <pre><code>vault {\n  agent_address = \"https://vault.example.com:8200\"\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n\n  auth {\n    method = \"jwt\"\n    jwt {\n      role = \"file-encryptor\"\n      path = \"/path/to/jwt/token\"\n      mount_path = \"auth/jwt\"  # Optional\n    }\n  }\n}\n</code></pre></p> <p>Environment variables: None (uses JWT file specified in config)</p>"},{"location":"#tls-certificate-authentication","title":"TLS Certificate Authentication","text":"<p>Use case: Mutual TLS environments</p> <p>Configuration: <pre><code>vault {\n  agent_address = \"https://vault.example.com:8200\"\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n\n  auth {\n    method = \"cert\"\n    cert {\n      client_cert = \"/path/to/client.crt\"\n      client_key = \"/path/to/client.key\"\n      mount_path = \"auth/cert\"  # Optional\n      name = \"file-encryptor\"   # Optional, defaults to cert common name\n    }\n  }\n}\n</code></pre></p> <p>Environment variables: None (uses certificate files specified in config)</p>"},{"location":"#authentication-best-practices","title":"Authentication Best Practices","text":"<p>Security: - Use environment variables for sensitive credentials instead of hardcoding in config files - Rotate credentials regularly - Use least-privilege Vault policies for each authentication method</p> <p>Production recommendations: - Preferred: Vault Agent or platform identity authentication - Avoid: Token authentication (development/testing only)</p> <p>Configuration rules: - Only one authentication method can be configured at a time - Environment variables override configuration file values</p> <p>Example with environment variables: <pre><code># Token authentication\nexport VAULT_TOKEN=\"hvs.CAES...\"\n./bin/file-encryptor watch -c config.hcl\n\n# AppRole authentication\nexport VAULT_ROLE_ID=\"your-role-id\"\nexport VAULT_SECRET_ID=\"your-secret-id\"\n./bin/file-encryptor encrypt -i file.txt -o file.enc -c config.hcl\n</code></pre></p>"},{"location":"#chunk-size-configuration","title":"Chunk Size Configuration","text":"<p>Control memory usage and performance by configuring the encryption chunk size:</p> <p>In Configuration File (<code>config.hcl</code>): <pre><code>encryption {\n  # ... other settings ...\n  chunk_size = \"2MB\"  # Options: 64KB-10MB, default 1MB\n}\n</code></pre></p> <p>CLI Override: <pre><code>./bin/file-encryptor encrypt -i file.txt -o file.txt.enc --chunk-size 512KB\n</code></pre></p> <p>Supported Formats: - Standard: <code>\"64KB\"</code>, <code>\"512KB\"</code>, <code>\"1MB\"</code>, <code>\"2MB\"</code>, <code>\"10MB\"</code> - Decimal: <code>\"1.5MB\"</code>, <code>\"0.5GB\"</code> - With spaces: <code>\"1 MB\"</code>, <code>\"512 KB\"</code> - Case insensitive: <code>\"1mb\"</code>, <code>\"1MB\"</code>, <code>\"1Mb\"</code> - Plain numbers: <code>\"1024\"</code> (bytes)</p> <p>Size Recommendations: - Small files (&lt;1MB): <code>256KB</code> - Lower memory usage - Medium files (1-100MB): <code>512KB-2MB</code> - Balanced (default: 1MB) - Large files (100MB-1GB): <code>2MB-4MB</code> - Better throughput - Very large files (&gt;1GB): <code>4MB-8MB</code> - Maximum performance</p> <p>Note: Service mode processes one file at a time, so choose chunk size based on your typical file size, not concurrent operations.</p> <p>See <code>guides/CHUNK_SIZE_TUNING.md</code> for detailed tuning guide with benchmarking and troubleshooting.</p>"},{"location":"#hot-reload","title":"Hot Reload","text":"<p>The application supports configuration hot-reload without restart on Unix systems (Linux, macOS, BSD).</p> <p>Unix/Linux/macOS: <pre><code># Find the process ID\nps aux | grep file-encryptor\n\n# Send SIGHUP signal\nkill -HUP &lt;pid&gt;\n# or\npkill -SIGHUP file-encryptor\n</code></pre></p> <p>Windows:</p> <p>Note: Hot-reload via signals is not supported on Windows due to OS limitations. To reload configuration, you must restart the service/application.</p> <p>To reload configuration on Windows: 1. Stop the application (Ctrl+C or Stop-Service) 2. Update the configuration file 3. Restart the application</p> <p>For Production: Use a Windows Service wrapper like NSSM or WinSW that can be easily stopped/started via service commands.</p>"},{"location":"#usage","title":"Usage","text":""},{"location":"#command-line-interface","title":"Command-Line Interface","text":"<pre><code>file-encryptor [command] [flags]\n\nCommands:\n  watch         Run as a service watching directories for files\n  encrypt       Encrypt a single file\n  decrypt       Decrypt a single file\n  rewrap        Re-wrap encrypted data keys to newer versions\n  key-versions  Display encryption key version statistics\n  help          Help about any command\n\nGlobal Flags:\n  -c, --config string      Configuration file path (default \"config.hcl\")\n  -l, --log-level string   Log level (debug, info, error) (default \"info\")\n  -o, --log-output string  Log output (stdout, stderr, or file path) (default \"stdout\")\n  -h, --help              Help for file-encryptor\n  -v, --version           Version information\n</code></pre>"},{"location":"#service-mode-examples","title":"Service Mode Examples","text":"<p>Start file watcher: <pre><code>./bin/file-encryptor watch -c config.hcl\n</code></pre></p> <p>Start with debug logging: <pre><code>./bin/file-encryptor watch -c config.hcl --log-level debug\n</code></pre></p> <p>Log to file: <pre><code>./bin/file-encryptor watch -c config.hcl --log-output /var/log/file-encryptor.log\n</code></pre></p>"},{"location":"#cli-mode-examples","title":"CLI Mode Examples","text":"<p>Encrypt a file: <pre><code>./bin/file-encryptor encrypt -i sensitive.pdf -o sensitive.pdf.enc\n</code></pre></p> <p>Encrypt with custom key file: <pre><code>./bin/file-encryptor encrypt -i data.txt -o data.txt.enc -k my-key.key\n</code></pre></p> <p>Encrypt with checksum: <pre><code>./bin/file-encryptor encrypt -i file.dat -o file.dat.enc --checksum\n</code></pre></p> <p>Decrypt a file: <pre><code>./bin/file-encryptor decrypt -i file.dat.enc -k file.dat.key -o decrypted-file.dat\n</code></pre></p> <p>Decrypt with checksum verification: <pre><code>./bin/file-encryptor decrypt -i file.dat.enc -k file.dat.key -o decrypted-file.dat --verify-checksum\n</code></pre></p> <p>Re-wrap encryption keys to newer version: <pre><code># Re-wrap all keys in a directory to minimum version 2\n./bin/file-encryptor rewrap --dir /path/to/keys --recursive --min-version 2\n\n# Dry-run to preview what would be re-wrapped\n./bin/file-encryptor rewrap --dir /path/to/keys --dry-run --min-version 2\n\n# Export results as JSON\n./bin/file-encryptor rewrap --dir /path/to/keys --min-version 2 --format json\n</code></pre></p> <p>Display key version statistics: <pre><code># Show version distribution for all keys in a directory (no config needed)\n./bin/file-encryptor key-versions --dir /path/to/keys --recursive\n\n# Output as JSON for analysis\n./bin/file-encryptor key-versions --dir /path/to/keys --format json\n\n# Output as CSV for spreadsheets\n./bin/file-encryptor key-versions --dir /path/to/keys --format csv\n</code></pre></p> <p>Note: The <code>key-versions</code> command works offline and does not require Vault configuration.</p> <p>For detailed rewrap documentation, see REWRAP_GUIDE.md.</p>"},{"location":"#architecture","title":"Architecture","text":"<p>For detailed architecture documentation, see ARCHITECTURE.md.</p>"},{"location":"#vault-policies","title":"Vault Policies","text":"<p>The application requires specific Vault Transit Engine capabilities depending on the operation mode. Three separate policies are recommended for least-privilege access:</p>"},{"location":"#1-encryption-policy","title":"1. Encryption Policy","text":"<p>Required for encrypting files (generating and encrypting data keys):</p> <pre><code># Policy name: file-encryptor-encrypt\npath \"transit/datakey/plaintext/file-encryption-key\" {\n  capabilities = [\"update\"]\n}\n</code></pre> <p>Capabilities: - <code>datakey/plaintext/*</code> - Generate a new data encryption key (DEK) in both plaintext and ciphertext forms</p> <p>Used by: - Service mode encryption operations - CLI <code>encrypt</code> command</p>"},{"location":"#2-decryption-policy","title":"2. Decryption Policy","text":"<p>Required for decrypting files (decrypting data keys):</p> <pre><code># Policy name: file-encryptor-decrypt\npath \"transit/decrypt/file-encryption-key\" {\n  capabilities = [\"update\"]\n}\n</code></pre> <p>Capabilities: - <code>decrypt/*</code> - Decrypt the ciphertext DEK to obtain the plaintext DEK</p> <p>Used by: - Service mode decryption operations - CLI <code>decrypt</code> command</p>"},{"location":"#3-re-wrap-policy","title":"3. Re-wrap Policy","text":"<p>Required for key rotation (re-wrapping encrypted DEKs to newer key versions):</p> <pre><code># Policy name: file-encryptor-rewrap\npath \"transit/rewrap/file-encryption-key\" {\n  capabilities = [\"update\"]\n}\n</code></pre> <p>Capabilities: - <code>rewrap/*</code> - Re-encrypt an existing ciphertext DEK with the latest key version without exposing plaintext</p> <p>Used by: - CLI <code>rewrap</code> command</p>"},{"location":"#combined-policy-developmenttesting-only","title":"Combined Policy (Development/Testing Only)","text":"<p>For development or testing environments, you can use a combined policy with all capabilities:</p> <pre><code># Policy name: file-encryptor-combined (NOT recommended for production)\npath \"transit/datakey/plaintext/file-encryption-key\" {\n  capabilities = [\"update\"]\n}\n\npath \"transit/decrypt/file-encryption-key\" {\n  capabilities = [\"update\"]\n}\n\npath \"transit/rewrap/file-encryption-key\" {\n  capabilities = [\"update\"]\n}\n</code></pre> <p>Production Recommendation: - Use separate policies for each operation type - Assign policies based on the specific role (encryption-only systems, decryption-only systems, key rotation operators) - Apply the principle of least privilege</p>"},{"location":"#policy-assignment-examples","title":"Policy Assignment Examples","text":"<p>HCP Vault (Token Auth): <pre><code># Create policies\nvault policy write file-encryptor-encrypt encrypt-policy.hcl\nvault policy write file-encryptor-decrypt decrypt-policy.hcl\nvault policy write file-encryptor-rewrap rewrap-policy.hcl\n\n# Generate tokens with specific policies\nvault token create -policy=file-encryptor-encrypt -period=24h\nvault token create -policy=file-encryptor-decrypt -period=24h\nvault token create -policy=file-encryptor-rewrap -period=1h\n</code></pre></p> <p>Vault Enterprise (Certificate Auth): <pre><code># Map certificate common names to policies\nvault write auth/cert/certs/file-encryptor-encrypt \\\n  certificate=@client-encrypt.crt \\\n  policies=file-encryptor-encrypt\n\nvault write auth/cert/certs/file-encryptor-decrypt \\\n  certificate=@client-decrypt.crt \\\n  policies=file-encryptor-decrypt\n\nvault write auth/cert/certs/file-encryptor-rewrap \\\n  certificate=@client-rewrap.crt \\\n  policies=file-encryptor-rewrap\n</code></pre></p> <p>Note: The <code>key-versions</code> command does not require any Vault access as it operates offline on local <code>.key</code> files.</p> <p>For complete Vault setup instructions including policy configuration, see: - Vault Setup Guide (HCP) - Vault Enterprise Setup Guide</p>"},{"location":"#documentation","title":"Documentation","text":""},{"location":"#user-guides","title":"User Guides","text":"<ul> <li>Architecture - System architecture and design</li> <li>CLI Mode Guide - CLI usage (Unix/Linux/macOS)</li> <li>CLI Mode Guide (Windows) - CLI usage for Windows</li> <li>Rewrap Guide - Key re-wrapping documentation</li> <li>Chunk Size Tuning - Performance optimization guide</li> </ul>"},{"location":"#setup-guides","title":"Setup Guides","text":"<p>Unix/Linux/macOS: - Vault Setup Guide (HCP) - HCP Vault setup instructions - Vault Enterprise Setup - Vault Enterprise setup</p> <p>Windows: - Vault Setup Guide (HCP) - Windows - HCP Vault setup for Windows</p> <p>Note: Vault Enterprise setup guide for Windows follows the same patterns as the Unix guide with PowerShell commands instead of bash. See the Unix guide and adapt commands for Windows.</p>"},{"location":"#platform-specific-notes","title":"Platform-Specific Notes","text":""},{"location":"#windows","title":"Windows","text":"<p>The application fully supports Windows with the following considerations:</p> <p>Installation: <pre><code># Download the Windows binary from releases\n# Extract to C:\\Program Files\\file-encryptor\\\n# Add to PATH for easy access\n$env:PATH += \";C:\\Program Files\\file-encryptor\"\n</code></pre></p> <p>Fully Supported: - CLI mode (encrypt/decrypt single files) - Service mode (watch directories) - File system watching via fsnotify - Graceful shutdown (Ctrl+C) - All crypto operations - Key re-wrapping and version auditing</p> <p>Important Differences: - Hot-reload not available: Configuration changes require service restart - Signal handling: Only Ctrl+C and SIGTERM work (no SIGHUP support) - Path separators: Use forward slashes (<code>/</code>) or double backslashes (<code>\\\\</code>) in config files - File permissions: Use <code>icacls</code> instead of <code>chmod</code> for setting permissions</p> <p>Running as Windows Service: <pre><code># Install NSSM (run as Administrator)\nchoco install nssm\n\n# Create service\nnssm install FileEncryptor \"C:\\Program Files\\file-encryptor\\file-encryptor.exe\"\nnssm set FileEncryptor AppParameters \"watch -c C:\\ProgramData\\file-encryptor\\config.hcl\"\nnssm set FileEncryptor Start SERVICE_AUTO_START\n\n# Start service\nStart-Service FileEncryptor\n</code></pre></p> <p>Configuration Example (Windows paths): <pre><code>encryption {\n  source_dir = \"C:/data/source\"  # Forward slashes recommended\n  dest_dir = \"C:/data/encrypted\"\n}\n\nqueue {\n  state_path = \"C:/ProgramData/file-encryptor/queue-state.json\"\n}\n\nlogging {\n  output = \"C:/ProgramData/file-encryptor/logs/app.log\"\n}\n</code></pre></p> <p>PowerShell Examples: <pre><code># CLI mode - works perfectly\n.\\file-encryptor.exe encrypt -i data.txt -o data.enc\n.\\file-encryptor.exe decrypt -i data.enc -k data.key -o data.txt\n\n# Service mode\n.\\file-encryptor.exe watch -c config.hcl\n# Press Ctrl+C to stop\n\n# To reload config: Stop and restart the service\nStop-Service FileEncryptor\nStart-Service FileEncryptor\n</code></pre></p> <p>Windows-Specific Guides: - CLI Mode (Windows) - Vault Setup (Windows)</p>"},{"location":"#linuxmacos","title":"Linux/macOS","text":"<p>All features fully supported including hot-reload via SIGHUP signal.</p> <p>Installation: <pre><code># Download binary from releases\n# Make executable\nchmod +x file-encryptor-linux-amd64\nsudo mv file-encryptor-linux-amd64 /usr/local/bin/file-encryptor\n\n# Or build from source\nmake build\n</code></pre></p> <p>Running as systemd service (Linux): <pre><code>sudo cp file-encryptor.service /etc/systemd/system/\nsudo systemctl daemon-reload\nsudo systemctl enable file-encryptor\nsudo systemctl start file-encryptor\n</code></pre></p> <p>Hot-reload configuration: <pre><code># Send SIGHUP to reload config without restart\npkill -SIGHUP file-encryptor\n</code></pre></p>"},{"location":"#security-considerations","title":"Security Considerations","text":""},{"location":"#cryptographic-security","title":"Cryptographic Security","text":"<ul> <li>Envelope Encryption: Data keys never stored unencrypted</li> <li>AES-256-GCM: Authenticated encryption with 256-bit keys</li> <li>Unique Nonces: Each chunk uses base nonce + counter (prevents nonce reuse)</li> <li>File Metadata Authentication: File size authenticated via GCM additional data</li> <li>Nonce Overflow Protection: Maximum 2^32 chunks per file (~4 petabytes with 1MB chunks)</li> </ul>"},{"location":"#memory-security","title":"Memory Security","text":"<ul> <li>Constant-Time Zeroing: Uses <code>crypto/subtle</code> to prevent compiler optimization</li> <li>Memory Locking: Plaintext DEKs locked in RAM (mlock) to prevent swapping to disk</li> <li>Immediate Cleanup: Keys zeroed from memory immediately after use</li> <li>Secure Patterns: Defer-based cleanup ensures keys are always zeroed</li> </ul>"},{"location":"#dos-prevention","title":"DOS Prevention","text":"<ul> <li>Chunk Size Validation: Rejects chunks larger than 10MB during decryption</li> <li>Resource Protection: Prevents memory exhaustion from malformed files</li> </ul>"},{"location":"#infrastructure-security","title":"Infrastructure Security","text":"<ul> <li>Vault Agent: Can use multiple authentication methods, keeping credentials rotated, and handles several types of secrets </li> <li>TLS: All Vault communication over HTTPS</li> <li>Audit Logging: All operations logged with security events</li> <li>No Primary Key Exposure: Primary key never leaves Vault</li> </ul>"},{"location":"#file-format-security","title":"File Format Security","text":"<p>Encrypted files include: - 12-byte master nonce (unique per file) - 8-byte authenticated file size - Per-chunk encryption with incremented nonces - GCM authentication tags (128-bit per chunk)</p> <p>For detailed security architecture, see <code>ARCHITECTURE.md</code>.</p>"},{"location":"#support","title":"Support","text":"<p>For issues and questions: - GitHub Issues: Report an issue - Documentation: See the <code>docs/</code> directory in this repository - Discussions: GitHub Discussions</p>"},{"location":"#contributing","title":"Contributing","text":"<p>Contributions are welcome! Please see CONTRIBUTING.md for guidelines.</p> <ol> <li>Fork the repository</li> <li>Create your feature branch (<code>git checkout -b feature/amazing-feature</code>)</li> <li>Commit your changes (<code>git commit -m 'Add amazing feature'</code>)</li> <li>Push to the branch (<code>git push origin feature/amazing-feature</code>)</li> <li>Open a Pull Request</li> </ol>"},{"location":"#license","title":"License","text":"<p>Copyright (c) 2025 Ricardo Oliveira</p> <p>This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.</p> <p>See LICENSE for full details.</p>"},{"location":"#quality-and-validation","title":"Quality and Validation","text":"<p>This project includes comprehensive validation tools to ensure code quality and security:</p>"},{"location":"#running-validations","title":"Running Validations","text":"<pre><code># Run all validation checks\nmake validate-all\n\n# Individual checks\nmake fmt-check      # Check code formatting\nmake vet            # Run go vet\nmake staticcheck    # Run static analysis\nmake lint           # Run golangci-lint\nmake gosec          # Run security scanner\nmake test           # Run all tests\n\n# Build with validation\nmake build-validated\n</code></pre>"},{"location":"#cicd-integration","title":"CI/CD Integration","text":"<p>See https://github.com/gitrgoliveira/vault-file-encryption/blob/main/.github/workflows/build-and-test.yml for the complete CI/CD pipeline.</p>"},{"location":"ARCHITECTURE/","title":"Architecture","text":"<p>This document describes the architecture of the Vault File Encryption tool, including its core components, data flows, and security model.</p>"},{"location":"ARCHITECTURE/#overview","title":"Overview","text":"<p>The application provides secure file encryption using HashiCorp Vault's Transit secrets engine. It implements envelope encryption, where a unique Data Encryption Key (DEK) is generated for each file and encrypted by Vault's primary key.</p>"},{"location":"ARCHITECTURE/#operation-modes","title":"Operation Modes","text":"Mode Command Description Service Mode <code>watch</code> Continuously monitors directories for new files CLI Mode <code>encrypt</code> / <code>decrypt</code> One-off encryption or decryption of individual files"},{"location":"ARCHITECTURE/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>graph TD\n    subgraph App[\"File Encryptor Application\"]\n        subgraph CLI_Interface[\"CLI Interface\"]\n            direction TB\n            watch[\"watch (service)\"]\n            encrypt[\"encrypt (one-off)\"]\n            decrypt[\"decrypt (one-off)\"]\n        end\n\n        file_watcher[\"File Watcher (fsnotify)\"]\n        queue[\"FIFO Queue (Persistent)\"]\n        processor[\"Direct Processor\"]\n        retry[\"Retry Logic (Exp Backoff)\"]\n\n        subgraph Crypto[\"Crypto Package\"]\n            Encryptor\n            Decryptor\n            Checksum\n        end\n\n        subgraph VaultClient[\"Vault Client\"]\n            DK_Ops[\"Data Key Operations\"]\n        end\n    end\n\n    watch --&gt; file_watcher\n    encrypt --&gt; processor\n    decrypt --&gt; processor\n\n    file_watcher --&gt; retry\n    retry --&gt; queue\n    queue --&gt; processor\n\n    processor --&gt; Encryptor\n    processor --&gt; Decryptor\n    processor --&gt; Checksum\n\n    Encryptor --&gt; DK_Ops\n    Decryptor --&gt; DK_Ops\n\n    DK_Ops --&gt; Agent[\"Vault Agent\"]\n    Agent --&gt; Vault[\"HCP Vault / Vault Enterprise\"]</code></pre>"},{"location":"ARCHITECTURE/#data-flow","title":"Data Flow","text":""},{"location":"ARCHITECTURE/#encryption-flow","title":"Encryption Flow","text":"<pre><code>graph TD\n    NewFile([\"New File\"]) --&gt; Watcher[\"File Watcher\"]\n    Watcher --&gt;|\"Stability Check\"| Queue[\"Enqueue Item\"]\n    Queue --&gt; FIFO[(\"FIFO Queue\")]\n    FIFO --&gt; Proc[\"Processor\"]\n\n    Proc --&gt; Checksum{\"Calc Checksum?\"}\n    Checksum -- Yes --&gt; SaveSum[\"Save .sha256\"]\n    Checksum -- No --&gt; ReqKey\n    SaveSum --&gt; ReqKey[\"Request Data Key\"]\n\n    ReqKey --&gt;|\"POST /transit/datakey\"| Vault[(\"Vault\")]\n    Vault --&gt;|\"plaintext DEK\"| Enc[\"Encrypt File\"]\n\n    Enc --&gt;|\"Write .enc\"| Dest[(\"Destination\")]\n    Enc --&gt;|\"Save .key\"| SaveKey[\"Save Ciphertext DEK\"]\n\n    SaveKey --&gt; Zero[\"Zero Plaintext DEK\"]\n    Zero --&gt; HandleSource{\"Handle Source\"}\n\n    HandleSource --&gt;|\"Archive\"| Archive[\"Move to archive/\"]\n    HandleSource --&gt;|\"Delete\"| Delete[\"Remove file\"]</code></pre>"},{"location":"ARCHITECTURE/#decryption-flow","title":"Decryption Flow","text":"<pre><code>graph TD\n    NewPair([\"Encrypted Pair Detected\"]) --&gt; Watcher[\"File Watcher\"]\n    Watcher --&gt; Queue[\"Enqueue Item\"]\n    Queue --&gt; FIFO[(\"FIFO Queue\")]\n    FIFO --&gt; Proc[\"Processor\"]\n\n    Proc --&gt; ReadKey[\"Read .key file\"]\n    ReadKey --&gt; DecKey[\"Decrypt DEK\"]\n\n    DecKey --&gt;|\"POST /transit/decrypt\"| Vault[(\"Vault\")]\n    Vault --&gt;|\"plaintext DEK\"| DecFile[\"Decrypt File\"]\n\n    DecFile --&gt; Verify{\"Verify Checksum?\"}\n    Verify -- Yes --&gt; CompSum[\"Compare .sha256\"]\n    Verify -- No --&gt; Zero\n    CompSum --&gt; Zero[\"Zero Plaintext DEK\"]\n\n    Zero --&gt; HandleSource{\"Handle Source\"}\n    HandleSource --&gt;|\"Archive\"| Archive[\"Move to archive/\"]\n    HandleSource --&gt;|\"Delete\"| Delete[\"Remove files\"]</code></pre>"},{"location":"ARCHITECTURE/#security-architecture","title":"Security Architecture","text":""},{"location":"ARCHITECTURE/#envelope-encryption","title":"Envelope Encryption","text":"<p>The application uses envelope encryption, a best practice for securing data at scale:</p> <ol> <li>Primary Key \u2014 Stored securely in Vault, never leaves the HSM/server</li> <li>Data Encryption Key (DEK) \u2014 Generated per-file, used locally for encryption</li> <li>Ciphertext DEK \u2014 The DEK encrypted by the primary key, safe to store</li> </ol> <pre><code>graph TD\n    Primary[\"Primary Key (Vault Transit)\"]\n\n    Primary --&gt;|\"Encrypts/Decrypts\"| DEK1[\"Data Encryption Key 1\"]\n    Primary --&gt; DEK2[\"Data Encryption Key 2\"]\n    Primary --&gt; DEK_More[\"Data Encryption Key N...\"]\n\n    DEK1 --&gt; Plaintext[\"Plaintext DEK (in memory only)\"]\n    DEK1 --&gt; Ciphertext[\"Ciphertext DEK (stored in .key file)\"]</code></pre>"},{"location":"ARCHITECTURE/#encrypted-file-format","title":"Encrypted File Format","text":"<pre><code>.enc File:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Magic Header \u2502 Version \u2502 Salt         \u2502 Chunk1       \u2502 ... \u2502\n\u2502 (4 bytes)    \u2502 (1 byte)\u2502 (32 bytes)   \u2502 (ciphertext) \u2502     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502              \u2502           \u2502              \u2502\n     \u2502              \u2502           \u2502              \u2514\u2500 Encrypted with AES-256-GCM\n     \u2502              \u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Argon2id/PBKDF2 salt\n     \u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Format version (v1)\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 File signature\n\n.key File:\nvault:v{version}:{base64-encrypted-DEK}\n</code></pre>"},{"location":"ARCHITECTURE/#security-features","title":"Security Features","text":"Feature Description AES-256-GCM Authenticated encryption with 256-bit keys Unique DEK per file Limits blast radius if a key is compromised Memory zeroing Plaintext keys are securely zeroed after use Integrity verification GCM authentication tags and optional SHA-256 checksums Vault Agent Local proxy for caching, authentication, and token renewal"},{"location":"ARCHITECTURE/#error-handling","title":"Error Handling","text":""},{"location":"ARCHITECTURE/#retry-strategy","title":"Retry Strategy","text":"<p>Failed operations are automatically retried with exponential backoff:</p> <pre><code>graph TD\n    Attempt[\"Processing Attempt\"] --&gt; Check{\"Success?\"}\n    Check -- Yes --&gt; Complete[\"Mark Complete\"] --&gt; Handle[\"Handle Source File\"]\n    Check -- No --&gt; Count{\"Check Retry Count\"}\n\n    Count --&gt;|\"&lt; Max Retries\"| Calc[\"Calculate Backoff\"]\n    Calc --&gt; Delay[\"delay = base * 2^attempts\"]\n    Delay --&gt; Fail[\"Mark Failed\"]\n    Fail --&gt; Requeue[\"Requeue to end of FIFO\"]\n\n    Count --&gt;|\"&gt;= Max Retries\"| DLQ[\"Mark as DLQ\"]\n    DLQ --&gt; MoveDLQ[\"Move to .dlq/ folder\"]</code></pre>"},{"location":"ARCHITECTURE/#dead-letter-queue","title":"Dead Letter Queue","text":"<p>Files that fail after all retries are moved to the <code>.dlq/</code> directory for manual investigation.</p>"},{"location":"ARCHITECTURE/#deployment","title":"Deployment","text":""},{"location":"ARCHITECTURE/#hcp-vault","title":"HCP Vault","text":"<pre><code>graph TD\n    subgraph Host[\"Host/VM\"]\n        FE[\"file-encryptor (systemd)\"]\n        VA[\"vault-agent (systemd)\"]\n\n        FE -- \"HTTP localhost\" --&gt; VA\n    end\n\n    VA -- \"HTTPS + Token\" --&gt; HCP[\"HCP Vault\"]</code></pre>"},{"location":"ARCHITECTURE/#vault-enterprise","title":"Vault Enterprise","text":"<pre><code>graph TD\n    subgraph Host[\"Host/VM\"]\n        FE[\"file-encryptor (systemd)\"]\n        VA[\"vault-agent (systemd)\"]\n\n        FE -- \"HTTP localhost\" --&gt; VA\n    end\n\n    VA -- \"HTTPS + Cert\" --&gt; Ent[\"Vault Enterprise\"]</code></pre>"},{"location":"ARCHITECTURE/#configuration","title":"Configuration","text":""},{"location":"ARCHITECTURE/#hot-reload","title":"Hot Reload","text":"<p>Configuration changes can be applied without restarting the service by sending a <code>SIGHUP</code> signal:</p> <pre><code>kill -HUP $(pidof file-encryptor)\n</code></pre> <p>The application will: 1. Load and validate the new configuration 2. Apply changes if valid (or keep the current config if invalid) 3. Update all affected components (Vault client, watcher paths, queue settings)</p>"},{"location":"ARCHITECTURE/#graceful-shutdown","title":"Graceful Shutdown","text":"<p>On receiving <code>SIGTERM</code> or <code>SIGINT</code>, the application:</p> <ol> <li>Stops accepting new files</li> <li>Saves the current queue state to disk</li> <li>Flushes logs</li> <li>Exits cleanly</li> </ol> <p>On restart, the queue state is restored and processing resumes.</p>"},{"location":"ARCHITECTURE/#performance","title":"Performance","text":"Aspect Implementation Streaming Files processed in 1MB chunks to limit memory usage Caching Vault Agent caches responses to reduce latency Sequential Processing Single processor ensures predictable ordering Progress Reporting Updates logged every 20% for large files"},{"location":"CONTRIBUTING/","title":"Contributing to Vault File Encryption","text":"<p>Thank you for considering contributing to this project! This document provides guidelines and instructions for contributing.</p>"},{"location":"CONTRIBUTING/#code-of-conduct","title":"Code of Conduct","text":"<p>By participating in this project, you agree to maintain a respectful and inclusive environment for all contributors.</p>"},{"location":"CONTRIBUTING/#how-can-i-contribute","title":"How Can I Contribute?","text":""},{"location":"CONTRIBUTING/#reporting-bugs","title":"Reporting Bugs","text":"<p>Before creating bug reports, please check the existing issues to avoid duplicates. When creating a bug report, include:</p> <ul> <li>Clear title and description</li> <li>Steps to reproduce the behavior</li> <li>Expected behavior</li> <li>Actual behavior</li> <li>Environment details (OS, Go version, Vault version)</li> <li>Relevant logs or error messages</li> </ul>"},{"location":"CONTRIBUTING/#suggesting-enhancements","title":"Suggesting Enhancements","text":"<p>Enhancement suggestions are welcome! Please include:</p> <ul> <li>Clear title and description</li> <li>Use case and motivation</li> <li>Possible implementation (if you have ideas)</li> <li>Alternative solutions you've considered</li> </ul>"},{"location":"CONTRIBUTING/#pull-requests","title":"Pull Requests","text":"<ol> <li>Fork the repository</li> <li>Create a feature branch (<code>git checkout -b feature/amazing-feature</code>)</li> <li>Make your changes</li> <li>Run all validation checks (<code>make validate-all</code>)</li> <li>Commit your changes (<code>git commit -m 'Add amazing feature'</code>)</li> <li>Push to your branch (<code>git push origin feature/amazing-feature</code>)</li> <li>Open a Pull Request</li> </ol>"},{"location":"CONTRIBUTING/#development-setup","title":"Development Setup","text":""},{"location":"CONTRIBUTING/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.25.0 or later</li> <li>Make</li> <li>golangci-lint</li> <li>gosec</li> <li>staticcheck</li> </ul>"},{"location":"CONTRIBUTING/#setup","title":"Setup","text":"<pre><code># Unix/Linux/macOS\n# Clone your fork\ngit clone https://github.com/YOUR_USERNAME/vault-file-encryption.git\ncd vault-file-encryption\n\n# Add upstream remote\ngit remote add upstream https://github.com/gitrgoliveira/vault-file-encryption.git\n\n# Install dependencies\nmake deps\n\n# Install linting tools\ngo install github.com/securego/gosec/v2/cmd/gosec@latest\ngo install honnef.co/go/tools/cmd/staticcheck@latest\n</code></pre> <pre><code># Windows (using Git Bash or WSL for Make, or use go commands directly)\n# Clone your fork\ngit clone https://github.com/YOUR_USERNAME/vault-file-encryption.git\ncd vault-file-encryption\n\n# Add upstream remote\ngit remote add upstream https://github.com/gitrgoliveira/vault-file-encryption.git\n\n# Install dependencies\ngo mod download\ngo mod tidy\n\n# Install linting tools\ngo install github.com/securego/gosec/v2/cmd/gosec@latest\ngo install honnef.co/go/tools/cmd/staticcheck@latest\n</code></pre>"},{"location":"CONTRIBUTING/#development-workflow","title":"Development Workflow","text":""},{"location":"CONTRIBUTING/#1-create-a-branch","title":"1. Create a Branch","text":"<pre><code>git checkout -b feature/my-feature\n</code></pre>"},{"location":"CONTRIBUTING/#2-make-changes","title":"2. Make Changes","text":"<p>Follow the existing code style and conventions:</p> <ul> <li>Use structured logging with key-value pairs</li> <li>Add comments for exported functions and types</li> <li>Keep functions focused and single-purpose</li> <li>Use meaningful variable names</li> </ul>"},{"location":"CONTRIBUTING/#3-write-tests","title":"3. Write Tests","text":"<ul> <li>Add unit tests for new functionality</li> <li>Ensure existing tests still pass</li> <li>Aim for 80%+ code coverage</li> <li>Use table-driven tests when appropriate</li> </ul> <p>Example test structure:</p> <pre><code>func TestMyFunction(t *testing.T) {\n    tests := []struct {\n        name      string\n        input     string\n        expected  string\n        shouldErr bool\n    }{\n        {\n            name:      \"valid input\",\n            input:     \"test\",\n            expected:  \"TEST\",\n            shouldErr: false,\n        },\n        // Add more test cases\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            result, err := MyFunction(tt.input)\n            if tt.shouldErr {\n                assert.Error(t, err)\n            } else {\n                assert.NoError(t, err)\n                assert.Equal(t, tt.expected, result)\n            }\n        })\n    }\n}\n</code></pre>"},{"location":"CONTRIBUTING/#4-run-validation","title":"4. Run Validation","text":"<p>Before committing, run all validation checks:</p> <pre><code># Run all checks\nmake validate-all\n\n# This runs:\n# - Code formatting check\n# - go vet\n# - staticcheck\n# - golangci-lint\n# - gosec security scan\n# - All tests with race detector\n</code></pre>"},{"location":"CONTRIBUTING/#5-fix-issues","title":"5. Fix Issues","text":"<p>If validation fails:</p> <pre><code># Fix formatting\nmake fmt\n\n# Address specific issues\nmake vet\nmake staticcheck\nmake lint\nmake gosec\n\n# Re-run validation\nmake validate-all\n</code></pre>"},{"location":"CONTRIBUTING/#6-commit-changes","title":"6. Commit Changes","text":"<p>Use clear, descriptive commit messages:</p> <pre><code>Add feature to support custom encryption algorithms\n\n- Implemented AES-256-GCM encryption\n- Added tests for new encryption methods\n- Updated documentation\n\nFixes #123\n</code></pre>"},{"location":"CONTRIBUTING/#7-push-and-create-pr","title":"7. Push and Create PR","text":"<pre><code>git push origin feature/my-feature\n</code></pre> <p>Then open a Pull Request on GitHub.</p>"},{"location":"CONTRIBUTING/#code-style-guidelines","title":"Code Style Guidelines","text":""},{"location":"CONTRIBUTING/#general-go-guidelines","title":"General Go Guidelines","text":"<ul> <li>Follow Effective Go</li> <li>Use <code>gofmt</code> for formatting (enforced by CI)</li> <li>Keep line length reasonable (preferably under 100 characters)</li> <li>Use early returns to reduce nesting</li> </ul>"},{"location":"CONTRIBUTING/#project-specific-conventions","title":"Project-Specific Conventions","text":""},{"location":"CONTRIBUTING/#logging","title":"Logging","text":"<p>Always use structured logging:</p> <pre><code>// Good\nlog.Info(\"processing file\", \"path\", filePath, \"size\", fileSize)\n\n// Bad\nlog.Info(\"Processing file: \" + filePath + \" size: \" + strconv.Itoa(fileSize))\n</code></pre>"},{"location":"CONTRIBUTING/#error-handling","title":"Error Handling","text":"<p>Wrap errors with context:</p> <pre><code>// Good\nif err != nil {\n    return fmt.Errorf(\"failed to encrypt file: %w\", err)\n}\n\n// Bad\nif err != nil {\n    return err\n}\n</code></pre>"},{"location":"CONTRIBUTING/#memory-security","title":"Memory Security","text":"<p>Always zero sensitive data and lock memory when handling keys:</p> <pre><code>// Get plaintext key from Vault\nplaintextKey, err := dataKey.PlaintextBytes()\nif err != nil {\n    return fmt.Errorf(\"failed to decode key: %w\", err)\n}\n\n// Lock key in memory to prevent swapping to disk (best effort)\nunlock, _ := crypto.LockMemory(plaintextKey)\ndefer unlock()\n\n// Ensure the key is zeroed when done (constant-time operation)\ndefer crypto.SecureZero(plaintextKey)\n\n// Use the key for encryption/decryption...\n</code></pre> <p>Important Security Patterns: - Always use <code>defer</code> immediately after obtaining sensitive data - Use <code>crypto.SecureZero()</code> for constant-time zeroing (prevents compiler optimization) - Use <code>crypto.LockMemory()</code> to prevent keys from being swapped to disk - Never store plaintext keys on disk - Zero buffers containing sensitive data before returning</p>"},{"location":"CONTRIBUTING/#configuration","title":"Configuration","text":"<p>Use HCL tags for configuration structs:</p> <pre><code>type Config struct {\n    Timeout string `hcl:\"timeout\"`\n    MaxRetries int `hcl:\"max_retries\"`\n}\n</code></pre>"},{"location":"CONTRIBUTING/#testing-guidelines","title":"Testing Guidelines","text":""},{"location":"CONTRIBUTING/#unit-tests","title":"Unit Tests","text":"<ul> <li>Place tests in <code>*_test.go</code> files alongside the code</li> <li>Use <code>testify/assert</code> and <code>testify/require</code></li> <li>Test happy paths and error cases</li> <li>Use table-driven tests for multiple scenarios</li> </ul>"},{"location":"CONTRIBUTING/#integration-tests","title":"Integration Tests","text":"<ul> <li>Place in <code>test/integration/</code></li> <li>Use build tag <code>//go:build integration</code></li> <li>Require Vault environment for execution</li> <li>Can be skipped in short mode</li> </ul>"},{"location":"CONTRIBUTING/#running-tests","title":"Running Tests","text":"<pre><code># All tests\nmake test\n\n# Integration tests (requires Vault)\nmake test-integration\n\n# Coverage report\nmake coverage\n\n# Specific package\ngo test -v ./internal/config\n\n# Specific test\ngo test -v ./internal/config -run TestLoadConfig\n</code></pre>"},{"location":"CONTRIBUTING/#pull-request-process","title":"Pull Request Process","text":""},{"location":"CONTRIBUTING/#before-submitting","title":"Before Submitting","text":"<ul> <li> All validation checks pass (<code>make validate-all</code>)</li> <li> Tests added for new functionality</li> <li> Documentation updated if needed</li> <li> CHANGELOG.md updated (for significant changes)</li> <li> No sensitive data in code or commits</li> </ul>"},{"location":"CONTRIBUTING/#pr-guidelines","title":"PR Guidelines","text":"<ul> <li>Title: Clear, concise description of changes</li> <li>Description: Explain what and why</li> <li>Link issues: Reference related issues with <code>Fixes #123</code></li> <li>Keep focused: One feature or fix per PR</li> <li>Size: Keep PRs reasonably sized for easier review</li> </ul>"},{"location":"CONTRIBUTING/#review-process","title":"Review Process","text":"<ol> <li>Automated checks run (CI/CD)</li> <li>Code review by maintainers</li> <li>Address feedback if requested</li> <li>Approval from at least one maintainer</li> <li>Squash and merge</li> </ol>"},{"location":"CONTRIBUTING/#security","title":"Security","text":""},{"location":"CONTRIBUTING/#reporting-security-issues","title":"Reporting Security Issues","text":"<p>Do not open public issues for security vulnerabilities.</p> <p>Instead, please report security issues by: 1. Opening a GitHub Security Advisory at https://github.com/gitrgoliveira/vault-file-encryption/security/advisories/new 2. Or emailing the repository owner (see GitHub profile for contact information)</p> <p>Include: - Description of the vulnerability - Steps to reproduce - Potential impact - Suggested fix (if you have one)</p>"},{"location":"CONTRIBUTING/#security-best-practices","title":"Security Best Practices","text":"<ul> <li>Never commit secrets or tokens</li> <li>Use <code>.env</code> for local development (git-ignored)</li> <li>Zero sensitive data from memory after use</li> <li>Validate all inputs</li> <li>Use prepared statements for any queries</li> <li>Keep dependencies up to date</li> </ul>"},{"location":"CONTRIBUTING/#documentation","title":"Documentation","text":""},{"location":"CONTRIBUTING/#code-documentation","title":"Code Documentation","text":"<ul> <li>Add godoc comments for exported types and functions</li> <li>Include usage examples in comments</li> <li>Keep comments up to date with code changes</li> </ul> <p>Example:</p> <pre><code>// EncryptFile encrypts the input file using AES-256-GCM with the provided key.\n// The encrypted output is written to the output file with the following format:\n//   [12-byte nonce][4-byte chunk size][encrypted chunk]...\n//\n// Example:\n//   err := EncryptFile(\"input.txt\", \"output.enc\", dataKey)\nfunc EncryptFile(inputPath, outputPath string, key []byte) error {\n    // Implementation\n}\n</code></pre>"},{"location":"CONTRIBUTING/#user-documentation","title":"User Documentation","text":"<ul> <li>Update README.md for user-facing changes</li> <li>Add examples for new features</li> <li>Update configuration examples if needed</li> <li>Keep architecture diagrams current</li> </ul>"},{"location":"CONTRIBUTING/#questions","title":"Questions?","text":"<p>If you have questions about contributing:</p> <ul> <li>Check existing issues and PRs</li> <li>Review Architecture documentation</li> <li>Check the Guides for feature-specific documentation</li> <li>Open a discussion issue</li> </ul>"},{"location":"CONTRIBUTING/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the Mozilla Public License 2.0 (MPL-2.0).</p> <p>Thank you for contributing to Vault File Encryption!</p>"},{"location":"MIGRATION_GUIDE/","title":"Migration Guide: v0.x to v1.0.0","text":"<p>Version 1.0.0 introduces a major architectural change by integrating the <code>go-fileencrypt</code> library for the underlying encryption primitives. This results in a breaking change to the encrypted file format.</p>"},{"location":"MIGRATION_GUIDE/#breaking-changes","title":"Breaking Changes","text":""},{"location":"MIGRATION_GUIDE/#file-format-incompatibility","title":"File Format Incompatibility","text":"<p>Files encrypted with versions prior to v1.0.0 are NOT compatible with v1.0.0+. You cannot decrypt old files with the new version.</p> <p>Action Required: Before upgrading to v1.0.0, you must: 1. Decrypt all existing files using your current version (v0.x). 2. Upgrade to v1.0.0. 3. Re-encrypt the files using v1.0.0.</p>"},{"location":"MIGRATION_GUIDE/#api-changes","title":"API Changes","text":"<p>If you are using this project as a library: - <code>Encryptor</code> and <code>Decryptor</code> structs no longer expose internal buffer pools. - <code>NewEncryptor</code> and <code>NewDecryptor</code> signatures remain the same, but internal behavior has changed. - <code>EncryptFile</code> and <code>DecryptFile</code> methods now use <code>go-fileencrypt</code> options internally.</p>"},{"location":"MIGRATION_GUIDE/#new-features","title":"New Features","text":"<ul> <li>Standardized File Format: Uses <code>go-fileencrypt</code>'s secure, versioned file format with magic headers and salt.</li> <li>Improved Security: Leverages well-tested crypto primitives and memory safety features from <code>go-fileencrypt</code>.</li> <li>Maintainability: Core crypto logic is now offloaded to a dedicated library.</li> </ul>"},{"location":"MIGRATION_GUIDE/#migration-steps","title":"Migration Steps","text":"<ol> <li> <p>Decrypt Existing Data (v0.x) <pre><code># Using v0.x binary\nvault-file-encryption decrypt --input my-secret.enc --output my-secret.txt --key my-secret.key\n</code></pre></p> </li> <li> <p>Upgrade Binary    Download or build the v1.0.0 binary.</p> </li> <li> <p>Re-encrypt Data (v1.0.0) <pre><code># Using v1.0.0 binary\nvault-file-encryption encrypt --input my-secret.txt --output my-secret.enc\n</code></pre></p> </li> </ol>"},{"location":"guides/CHUNK_SIZE_TUNING/","title":"Chunk Size Tuning Guide","text":""},{"location":"guides/CHUNK_SIZE_TUNING/#overview","title":"Overview","text":"<p>The chunk size determines how much data is encrypted/decrypted in a single AES-GCM operation. This guide helps you choose the optimal chunk size for your use case.</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#default-configuration","title":"Default Configuration","text":"<p>Default Chunk Size: 1 MB (1048576 bytes)</p> <p>This default is optimized for general-purpose use and provides a good balance between: - Memory usage - CPU efficiency - File I/O performance - Progress reporting granularity</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#valid-range","title":"Valid Range","text":"<ul> <li>Minimum: 64 KB (65536 bytes)</li> <li>Maximum: 10 MB (10485760 bytes)</li> </ul> <p>Values must be multiples of 4 KB (4096 bytes) for optimal AES alignment.</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#configuration-methods","title":"Configuration Methods","text":""},{"location":"guides/CHUNK_SIZE_TUNING/#1-global-configuration-hcl","title":"1. Global Configuration (HCL)","text":"<p>Set the chunk size in your configuration file:</p> <pre><code>encryption {\n  chunk_size = \"2MB\"  # Apply to all operations\n}\n</code></pre> <p>Supported formats: - <code>\"512KB\"</code> - Kilobytes - <code>\"2MB\"</code> - Megabytes - <code>\"1048576\"</code> - Bytes (no unit)</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#2-cli-override","title":"2. CLI Override","text":"<p>Override the configured chunk size for a specific operation:</p> <pre><code># Encrypt with custom chunk size\n./file-encryptor encrypt -i large.bin -o large.enc --chunk-size 4MB\n\n# Decrypt uses the chunk size from when the file was encrypted\n./file-encryptor decrypt -i large.enc -k large.key -o large.bin\n</code></pre> <p>Note: Decryption automatically reads the chunk size from the encrypted file header, so you don't need to specify it during decryption.</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"guides/CHUNK_SIZE_TUNING/#small-chunk-sizes-64kb-512kb","title":"Small Chunk Sizes (64KB - 512KB)","text":"<p>Advantages: - Lower memory usage per operation - More granular progress reporting - Better for resource-constrained environments - Faster cancellation response</p> <p>Disadvantages: - More CPU overhead (more encryption operations) - More file I/O operations - Higher metadata overhead - Slower overall throughput</p> <p>Use When: - Running on systems with limited RAM - Processing many small files sequentially - Need responsive progress updates - Files are typically small (&lt;10MB)</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#medium-chunk-sizes-512kb-2mb","title":"Medium Chunk Sizes (512KB - 2MB)","text":"<p>Advantages: - Balanced memory/CPU trade-off - Good throughput for most file sizes - Reasonable progress granularity - Minimal overhead</p> <p>Disadvantages: - Middle-ground trade-offs</p> <p>Use When: - General-purpose encryption (default) - Mixed file sizes - Standard server/workstation hardware - Balanced requirements</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#large-chunk-sizes-2mb-10mb","title":"Large Chunk Sizes (2MB - 10MB)","text":"<p>Advantages: - Maximum throughput for large files - Fewer encryption operations - Lower CPU overhead per byte - Reduced metadata size</p> <p>Disadvantages: - Higher memory usage per operation - Less granular progress reporting - Slower cancellation response - Larger buffer pool allocation</p> <p>Use When: - Processing very large files (&gt;100MB) - High-performance hardware available - Throughput is critical - Memory is not constrained</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#tuning-recommendations","title":"Tuning Recommendations","text":""},{"location":"guides/CHUNK_SIZE_TUNING/#by-file-size","title":"By File Size","text":"Average File Size Recommended Chunk Size &lt; 1 MB 256 KB 1 MB - 10 MB 512 KB - 1 MB (default) 10 MB - 100 MB 1 MB - 2 MB 100 MB - 1 GB 2 MB - 4 MB &gt; 1 GB 4 MB - 8 MB"},{"location":"guides/CHUNK_SIZE_TUNING/#by-use-case","title":"By Use Case","text":"<p>High-Throughput Batch Processing: <pre><code>encryption {\n  chunk_size = \"4MB\"  # Maximize throughput\n}\n</code></pre></p> <p>Real-Time Monitoring (Service Mode): <pre><code>encryption {\n  chunk_size = \"1MB\"  # Balanced default\n}\n</code></pre></p> <p>Resource-Constrained Environments: <pre><code>encryption {\n  chunk_size = \"256KB\"  # Minimize memory\n}\n</code></pre></p> <p>Docker/Container Deployments: <pre><code>encryption {\n  chunk_size = \"512KB\"  # Balance memory limits\n}\n</code></pre></p>"},{"location":"guides/CHUNK_SIZE_TUNING/#memory-impact","title":"Memory Impact","text":"<p>Each encryption/decryption operation allocates buffers using a <code>sync.Pool</code>. Memory usage per operation:</p> <pre><code>Memory per operation \u2248 chunk_size \u00d7 2 (read + write buffers)\n</code></pre> <p>Examples: - 256 KB chunk \u2192 ~512 KB per operation - 1 MB chunk \u2192 ~2 MB per operation - 4 MB chunk \u2192 ~8 MB per operation</p> <p>Service Mode: The service processes files sequentially (one at a time), so memory usage is simply:</p> <pre><code>Total memory \u2248 chunk_size \u00d7 2\n</code></pre> <p>For example, with the default 1 MB chunk size, expect approximately 2 MB of buffer memory during file processing.</p> <p>Note: The service uses a single processor that handles one file at a time from the queue. This means chunk size affects the memory footprint for processing each individual file, not concurrent operations.</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#file-format-compatibility","title":"File Format Compatibility","text":"<p>Backward Compatibility: Files encrypted with different chunk sizes can all be decrypted, as the chunk size is stored in the encrypted file format:</p> <pre><code>[12-byte nonce][4-byte chunk_size][encrypted_chunk]...\n</code></pre> <p>This means you can: - Change chunk size between operations - Decrypt files encrypted with any valid chunk size - Mix files encrypted with different chunk sizes</p> <p>Important: Once a file is encrypted, its chunk size is fixed. You cannot change it without re-encrypting the file.</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#monitoring-and-validation","title":"Monitoring and Validation","text":""},{"location":"guides/CHUNK_SIZE_TUNING/#configuration-validation","title":"Configuration Validation","text":"<p>The application validates chunk size on startup:</p> <pre><code>$ ./file-encryptor watch -c config.hcl\nERROR: invalid chunk_size: must be between 64KB and 10MB, got 16MB\n</code></pre>"},{"location":"guides/CHUNK_SIZE_TUNING/#progress-logging","title":"Progress Logging","text":"<p>Progress is logged at 20% intervals regardless of chunk size:</p> <pre><code>INFO Encryption progress file=large.bin progress=20.0\nINFO Encryption progress file=large.bin progress=40.0\nINFO Encryption progress file=large.bin progress=60.0\nINFO Encryption progress file=large.bin progress=80.0\nINFO Encryption complete file=large.bin\n</code></pre> <p>With larger chunk sizes, you'll see fewer progress updates for small files.</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/CHUNK_SIZE_TUNING/#out-of-memory-errors","title":"Out of Memory Errors","text":"<p>Symptom: Application crashes with OOM errors during encryption.</p> <p>Solution: Reduce chunk size: <pre><code>encryption {\n  chunk_size = \"256KB\"  # Down from 4MB\n}\n</code></pre></p>"},{"location":"guides/CHUNK_SIZE_TUNING/#slow-performance","title":"Slow Performance","text":"<p>Symptom: Encryption is slower than expected for large files.</p> <p>Solution: Increase chunk size if memory allows: <pre><code>encryption {\n  chunk_size = \"4MB\"  # Up from 1MB\n}\n</code></pre></p>"},{"location":"guides/CHUNK_SIZE_TUNING/#validation-errors","title":"Validation Errors","text":"<p>Symptom: <pre><code>ERROR: invalid chunk_size: must be a multiple of 4096 bytes\n</code></pre></p> <p>Solution: Ensure chunk size is AES-aligned: <pre><code>encryption {\n  chunk_size = \"512KB\"  # OK - 524288 is divisible by 4096\n  # chunk_size = \"500KB\"  # FAIL - 512000 not divisible by 4096\n}\n</code></pre></p>"},{"location":"guides/CHUNK_SIZE_TUNING/#benchmarking","title":"Benchmarking","text":"<p>To find the optimal chunk size for your environment, use the CLI encrypt command with different sizes:</p> <pre><code># Test 512KB chunks\ntime ./file-encryptor encrypt -i test.bin -o test1.enc --chunk-size 512KB\n\n# Test 2MB chunks\ntime ./file-encryptor encrypt -i test.bin -o test2.enc --chunk-size 2MB\n\n# Test 4MB chunks\ntime ./file-encryptor encrypt -i test.bin -o test3.enc --chunk-size 4MB\n</code></pre> <p>Compare: - Total execution time - Memory usage (use <code>top</code> or <code>htop</code> during execution) - CPU utilization</p>"},{"location":"guides/CHUNK_SIZE_TUNING/#best-practices","title":"Best Practices","text":"<ol> <li>Start with the default (1MB) - Good for most use cases</li> <li>Profile before tuning - Measure actual performance before changing</li> <li>Consider memory limits - Especially in containerized environments</li> <li>Test with representative files - Use actual file sizes from your workload</li> <li>Monitor in production - Watch for OOM errors or performance issues</li> <li>Document your choice - Add comments to your HCL config explaining the chunk size</li> </ol>"},{"location":"guides/CHUNK_SIZE_TUNING/#example-configurations","title":"Example Configurations","text":""},{"location":"guides/CHUNK_SIZE_TUNING/#cloud-storage-backup","title":"Cloud Storage Backup","text":"<pre><code># Large files, high throughput required\nencryption {\n  chunk_size = \"4MB\"\n}\n</code></pre>"},{"location":"guides/CHUNK_SIZE_TUNING/#iotedge-device","title":"IoT/Edge Device","text":"<pre><code># Limited memory, small files\nencryption {\n  chunk_size = \"128KB\"\n}\n</code></pre>"},{"location":"guides/CHUNK_SIZE_TUNING/#general-server","title":"General Server","text":"<pre><code># Balanced default\nencryption {\n  chunk_size = \"1MB\"\n}\n</code></pre>"},{"location":"guides/CHUNK_SIZE_TUNING/#high-security-archive","title":"High-Security Archive","text":"<pre><code># Optimized for verification speed\nencryption {\n  chunk_size = \"2MB\"\n  generate_checksum = true\n}\n</code></pre>"},{"location":"guides/CLI_MODE/","title":"CLI Mode - One-Off Encryption/Decryption","text":"<p>This document describes the CLI mode for one-off file encryption and decryption operations on Unix, Linux, and macOS platforms.</p> <p>For Windows users, see CLI_MODE_WINDOWS.md for PowerShell examples and Windows-specific instructions.</p>"},{"location":"guides/CLI_MODE/#overview","title":"Overview","text":"<p>In addition to the service mode (continuous file watching), the application supports CLI mode for encrypting or decrypting individual files on demand. This is useful for:</p> <ul> <li>Ad-hoc encryption of sensitive files</li> <li>Batch processing via shell scripts</li> <li>Testing and validation</li> <li>Integration with other tools and workflows</li> </ul>"},{"location":"guides/CLI_MODE/#commands","title":"Commands","text":""},{"location":"guides/CLI_MODE/#watch-command-service-mode","title":"Watch Command (Service Mode)","text":"<p>Runs the continuous file watching service.</p> <pre><code>file-encryptor watch -c config.hcl\n</code></pre> <p>Options: - <code>-c, --config</code>: Configuration file path (default: config.hcl) - <code>-l, --log-level</code>: Log level (debug, info, error) - <code>-o, --log-output</code>: Log output (stdout, stderr, or file path)</p>"},{"location":"guides/CLI_MODE/#encrypt-command-one-off","title":"Encrypt Command (One-Off)","text":"<p>Encrypts a single file using Vault Transit Engine.</p> <pre><code>file-encryptor encrypt -i input.txt -o output.txt.enc\n</code></pre> <p>Options: - <code>-i, --input</code>: Input file to encrypt (required) - <code>-o, --output</code>: Output encrypted file (required) - <code>-k, --key</code>: Output key file (default: <code>&lt;input&gt;.key</code>) - <code>--checksum</code>: Calculate and save SHA256 checksum - <code>-c, --config</code>: Configuration file for Vault settings (default: config.hcl) - <code>-l, --log-level</code>: Log level - <code>-o, --log-output</code>: Log output</p> <p>Examples:</p> <pre><code># Basic encryption\nfile-encryptor encrypt -i sensitive-data.pdf -o sensitive-data.pdf.enc\n\n# Specify custom key file location\nfile-encryptor encrypt -i data.txt -o encrypted/data.txt.enc -k keys/data.txt.key\n\n# Encrypt with checksum\nfile-encryptor encrypt -i document.docx -o document.docx.enc --checksum\n\n# Encrypt with debug logging\nfile-encryptor encrypt -i file.bin -o file.bin.enc -l debug\n</code></pre> <p>Output Files: - <code>&lt;output&gt;</code>: Encrypted file - <code>&lt;input&gt;.key</code>: Encrypted data encryption key (named after input file) - <code>&lt;input&gt;.sha256</code>: Checksum file of original input (if <code>--checksum</code> specified)</p>"},{"location":"guides/CLI_MODE/#decrypt-command-one-off","title":"Decrypt Command (One-Off)","text":"<p>Decrypts a single file that was encrypted with Vault Transit Engine.</p> <pre><code>file-encryptor decrypt -i input.txt.enc -k input.txt.key -o output.txt\n</code></pre> <p>Options: - <code>-i, --input</code>: Encrypted file to decrypt (required) - <code>-k, --key</code>: Key file (required) - <code>-o, --output</code>: Output decrypted file (required) - <code>--verify-checksum</code>: Verify SHA256 checksum if available - <code>-c, --config</code>: Configuration file for Vault settings (default: config.hcl) - <code>-l, --log-level</code>: Log level - <code>-o, --log-output</code>: Log output</p> <p>Examples:</p> <pre><code># Basic decryption\nfile-encryptor decrypt -i sensitive-data.pdf.enc -k sensitive-data.pdf.key -o sensitive-data.pdf\n\n# Decrypt with checksum verification\nfile-encryptor decrypt -i document.docx.enc -k document.docx.key -o document.docx --verify-checksum\n\n# Decrypt with debug logging\nfile-encryptor decrypt -i file.bin.enc -k file.bin.key -o file.bin -l debug\n</code></pre>"},{"location":"guides/CLI_MODE/#configuration-requirements","title":"Configuration Requirements","text":"<p>CLI mode requires minimal configuration - only Vault connection settings are needed.</p>"},{"location":"guides/CLI_MODE/#minimal-configuration-for-cli-mode","title":"Minimal Configuration for CLI Mode","text":"<pre><code># config.hcl - Minimal configuration for CLI mode\n\nvault {\n  agent_address = \"http://127.0.0.1:8200\"\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n}\n\n# Logging configuration (optional)\nlogging {\n  level = \"info\"\n  format = \"text\"\n}\n</code></pre> <p>The following configuration sections are NOT required for CLI mode: - <code>encryption</code> (source/dest directories) - <code>decryption</code> (source/dest directories) - <code>queue</code> (state path, retries)</p>"},{"location":"guides/CLI_MODE/#exit-codes","title":"Exit Codes","text":"<ul> <li><code>0</code>: Success</li> <li><code>1</code>: General error (file not found, encryption/decryption failed, etc.)</li> <li><code>2</code>: Configuration error</li> <li><code>3</code>: Vault connection error</li> </ul>"},{"location":"guides/CLI_MODE/#shell-script-integration","title":"Shell Script Integration","text":""},{"location":"guides/CLI_MODE/#batch-encryption-example","title":"Batch Encryption Example","text":"<pre><code>#!/bin/bash\n# Encrypt all files in a directory\n\nSOURCE_DIR=\"/path/to/source\"\nDEST_DIR=\"/path/to/encrypted\"\n\nfor file in \"$SOURCE_DIR\"/*; do\n    filename=$(basename \"$file\")\n    echo \"Encrypting $filename...\"\n    file-encryptor encrypt \\\n        -i \"$file\" \\\n        -o \"$DEST_DIR/$filename.enc\" \\\n        -k \"$DEST_DIR/$filename.key\" \\\n        --checksum\n\n    if [ $? -eq 0 ]; then\n        echo \"[OK] $filename encrypted successfully\"\n    else\n        echo \"[FAILED] Failed to encrypt $filename\" &gt;&amp;2\n    fi\ndone\n</code></pre>"},{"location":"guides/CLI_MODE/#batch-decryption-example","title":"Batch Decryption Example","text":"<pre><code>#!/bin/bash\n# Decrypt all .enc files in a directory\n\nSOURCE_DIR=\"/path/to/encrypted\"\nDEST_DIR=\"/path/to/decrypted\"\n\nfor enc_file in \"$SOURCE_DIR\"/*.enc; do\n    filename=$(basename \"$enc_file\" .enc)\n    key_file=\"${enc_file%.enc}.key\"\n\n    if [ ! -f \"$key_file\" ]; then\n        echo \"[ERROR] Key file not found for $filename\" &gt;&amp;2\n        continue\n    fi\n\n    echo \"Decrypting $filename...\"\n    file-encryptor decrypt \\\n        -i \"$enc_file\" \\\n        -k \"$key_file\" \\\n        -o \"$DEST_DIR/$filename\" \\\n        --verify-checksum\n\n    if [ $? -eq 0 ]; then\n        echo \"[OK] $filename decrypted successfully\"\n    else\n        echo \"[FAILED] Failed to decrypt $filename\" &gt;&amp;2\n    fi\ndone\n</code></pre>"},{"location":"guides/CLI_MODE/#progress-reporting","title":"Progress Reporting","text":"<p>For large files, progress is logged every 20%:</p> <pre><code>2025-11-05T10:30:45Z [INFO] Encrypting file input=largefile.bin output=largefile.bin.enc\n2025-11-05T10:30:46Z [INFO] Encryption progress percent=20\n2025-11-05T10:30:47Z [INFO] Encryption progress percent=40\n2025-11-05T10:30:48Z [INFO] Encryption progress percent=60\n2025-11-05T10:30:49Z [INFO] Encryption progress percent=80\n2025-11-05T10:30:50Z [INFO] Encryption progress percent=100\n2025-11-05T10:30:50Z [INFO] File encrypted successfully input=largefile.bin output=largefile.bin.enc\n</code></pre>"},{"location":"guides/CLI_MODE/#error-handling","title":"Error Handling","text":""},{"location":"guides/CLI_MODE/#common-errors-and-solutions","title":"Common Errors and Solutions","text":"<p>Error: <code>input file not found</code> <pre><code>Solution: Verify the input file path is correct and the file exists\n</code></pre></p> <p>Error: <code>failed to load configuration</code> <pre><code>Solution: Ensure config file exists and contains valid Vault settings\n</code></pre></p> <p>Error: <code>vault health check failed</code> <pre><code>Solution: Ensure Vault Agent is running and accessible at the configured address\n</code></pre></p> <p>Error: <code>failed to generate data key</code> <pre><code>Solution: Check Vault connectivity and ensure the transit key exists and you have permission\n</code></pre></p> <p>Error: <code>checksum verification failed</code> <pre><code>Solution: The decrypted file may be corrupted or tampered with\n</code></pre></p>"},{"location":"guides/CLI_MODE/#testing-cli-mode","title":"Testing CLI Mode","text":""},{"location":"guides/CLI_MODE/#unit-tests","title":"Unit Tests","text":"<pre><code>func TestEncryptCommand(t *testing.T) {\n    // Create test file\n    tmpFile := createTestFile(t, \"test content\")\n    defer os.Remove(tmpFile)\n\n    // Run encrypt command\n    err := runEncrypt(tmpFile, tmpFile+\".enc\", \"\", false)\n    require.NoError(t, err)\n\n    // Verify outputs exist\n    assert.FileExists(t, tmpFile+\".enc\")\n    assert.FileExists(t, tmpFile+\".key\")\n}\n\nfunc TestDecryptCommand(t *testing.T) {\n    // Setup encrypted file\n    encFile, keyFile := setupEncryptedFile(t)\n    defer cleanup(encFile, keyFile)\n\n    // Run decrypt command\n    outFile := t.TempDir() + \"/decrypted.txt\"\n    err := runDecrypt(encFile, keyFile, outFile, false)\n    require.NoError(t, err)\n\n    // Verify decrypted content\n    content, _ := os.ReadFile(outFile)\n    assert.Equal(t, \"test content\", string(content))\n}\n</code></pre>"},{"location":"guides/CLI_MODE/#integration-test","title":"Integration Test","text":"<pre><code>#!/bin/bash\n# Integration test for CLI mode\n\nset -e\n\necho \"Testing CLI mode...\"\n\n# Test encryption\necho \"secret data\" &gt; test.txt\nfile-encryptor encrypt -i test.txt -o test.txt.enc --checksum\necho \"[OK] Encryption successful\"\n\n# Verify files exist\n[ -f test.txt.enc ] &amp;&amp; echo \"[OK] Encrypted file created\"\n[ -f test.txt.key ] &amp;&amp; echo \"[OK] Key file created\"\n[ -f test.txt.sha256 ] &amp;&amp; echo \"[OK] Checksum file created\"\n\n# Test decryption\nfile-encryptor decrypt -i test.txt.enc -k test.txt.key -o test-decrypted.txt --verify-checksum\necho \"[OK] Decryption successful\"\n\n# Verify content\nif diff test.txt test-decrypted.txt &gt; /dev/null; then\n    echo \"[OK] Decrypted content matches original\"\nelse\n    echo \"[ERROR] Decrypted content does not match\" &gt;&amp;2\n    exit 1\nfi\n\n# Cleanup\nrm test.txt test.txt.enc test.txt.key test.txt.sha256 test-decrypted.txt\necho \"[OK] All CLI tests passed\"\n</code></pre>"},{"location":"guides/CLI_MODE/#performance-considerations","title":"Performance Considerations","text":"<ul> <li>Streaming: Files are processed in 1MB chunks, memory usage is constant regardless of file size</li> <li>Progress: Updates logged every 20% to track long-running operations</li> <li>No Queue: CLI mode bypasses the queue system for immediate processing</li> <li>Single Operation: Each command processes exactly one file then exits</li> </ul>"},{"location":"guides/CLI_MODE/#security-considerations","title":"Security Considerations","text":"<ol> <li>Key File Security: The <code>.key</code> files contain encrypted DEKs and should be stored securely</li> <li>Permissions: Consider setting restrictive permissions on encrypted files and keys</li> <li>Cleanup: Ensure the original file is handled securely after encryption (delete or move to secure location)</li> <li>Logging: Be careful not to log sensitive file paths or content</li> <li>Memory: Plaintext DEKs are zeroed from memory after use</li> </ol>"},{"location":"guides/CLI_MODE/#comparison-cli-mode-vs-service-mode","title":"Comparison: CLI Mode vs Service Mode","text":"Feature CLI Mode Service Mode Use Case One-off operations Continuous monitoring Queue No Yes (FIFO with persistence) Retry Logic No Yes (exponential backoff) File Watching No Yes (fsnotify) Configuration Minimal (Vault only) Full (directories, queue, etc.) Graceful Shutdown N/A (exits immediately) Yes (saves queue state) Hot Reload No Yes (Unix/Linux/macOS only) Batch Processing Via shell scripts Automatic Progress Reporting Logged to console Logged to file/stdout"},{"location":"guides/CLI_MODE/#platform-specific-documentation","title":"Platform-Specific Documentation","text":"<ul> <li>Unix/Linux/macOS: This guide</li> <li>Windows: See CLI_MODE_WINDOWS.md</li> </ul>"},{"location":"guides/CLI_MODE/#adding-to-documentation","title":"Adding to Documentation","text":"<p>Update the main README.md with CLI usage:</p> <pre><code>## Usage\n\n### Service Mode (Continuous Watching)\n\n```bash\n# Start the file watcher service\nfile-encryptor watch -c config.hcl\n</code></pre>"},{"location":"guides/CLI_MODE/#cli-mode-one-off-operations","title":"CLI Mode (One-Off Operations)","text":"<pre><code># Encrypt a single file\nfile-encryptor encrypt -i input.txt -o output.txt.enc --checksum\n\n# Decrypt a single file\nfile-encryptor decrypt -i output.txt.enc -k output.txt.key -o decrypted.txt --verify-checksum\n</code></pre> <p>For detailed CLI usage, see CLI Mode Documentation. ```</p> <p>This CLI mode provides flexibility for both automated service-based encryption and manual/scripted operations, making the tool suitable for a wider range of use cases.</p>"},{"location":"guides/CLI_MODE_WINDOWS/","title":"CLI Mode - One-Off Encryption/Decryption (Windows)","text":"<p>This document describes the CLI mode for one-off file encryption and decryption operations on Windows platforms.</p> <p>For Unix/Linux/macOS instructions, see CLI_MODE.md</p>"},{"location":"guides/CLI_MODE_WINDOWS/#overview","title":"Overview","text":"<p>In addition to the service mode (continuous file watching), the application supports CLI mode for encrypting or decrypting individual files on demand. This is useful for:</p> <ul> <li>Ad-hoc encryption of sensitive files</li> <li>Batch processing via PowerShell scripts</li> <li>Testing and validation</li> <li>Integration with other tools and workflows</li> </ul>"},{"location":"guides/CLI_MODE_WINDOWS/#commands","title":"Commands","text":""},{"location":"guides/CLI_MODE_WINDOWS/#watch-command-service-mode","title":"Watch Command (Service Mode)","text":"<p>Runs the continuous file watching service.</p> <pre><code>.\\file-encryptor.exe watch -c config.hcl\n</code></pre> <p>Options: - <code>-c, --config</code>: Configuration file path (default: config.hcl) - <code>-l, --log-level</code>: Log level (debug, info, error) - <code>-o, --log-output</code>: Log output (stdout, stderr, or file path)</p>"},{"location":"guides/CLI_MODE_WINDOWS/#encrypt-command-one-off","title":"Encrypt Command (One-Off)","text":"<p>Encrypts a single file using Vault Transit Engine.</p> <pre><code>.\\file-encryptor.exe encrypt -i input.txt -o output.txt.enc\n</code></pre> <p>Options: - <code>-i, --input</code>: Input file to encrypt (required) - <code>-o, --output</code>: Output encrypted file (required) - <code>-k, --key</code>: Output key file (default: <code>&lt;input&gt;.key</code>) - <code>--checksum</code>: Calculate and save SHA256 checksum - <code>-c, --config</code>: Configuration file for Vault settings (default: config.hcl) - <code>-l, --log-level</code>: Log level - <code>-o, --log-output</code>: Log output</p> <p>Examples:</p> <pre><code># Basic encryption\n.\\file-encryptor.exe encrypt -i sensitive-data.pdf -o sensitive-data.pdf.enc\n\n# Specify custom key file location\n.\\file-encryptor.exe encrypt -i data.txt -o encrypted\\data.txt.enc -k keys\\data.txt.key\n\n# Encrypt with checksum\n.\\file-encryptor.exe encrypt -i document.docx -o document.docx.enc --checksum\n\n# Encrypt with debug logging\n.\\file-encryptor.exe encrypt -i file.bin -o file.bin.enc -l debug\n</code></pre> <p>Output Files: - <code>&lt;output&gt;</code>: Encrypted file - <code>&lt;input&gt;.key</code>: Encrypted data encryption key (named after input file) - <code>&lt;input&gt;.sha256</code>: Checksum file of original input (if <code>--checksum</code> specified)</p>"},{"location":"guides/CLI_MODE_WINDOWS/#decrypt-command-one-off","title":"Decrypt Command (One-Off)","text":"<p>Decrypts a single file that was encrypted with Vault Transit Engine.</p> <pre><code>.\\file-encryptor.exe decrypt -i input.txt.enc -k input.txt.key -o output.txt\n</code></pre> <p>Options: - <code>-i, --input</code>: Encrypted file to decrypt (required) - <code>-k, --key</code>: Key file (required) - <code>-o, --output</code>: Output decrypted file (required) - <code>--verify-checksum</code>: Verify SHA256 checksum if available - <code>-c, --config</code>: Configuration file for Vault settings (default: config.hcl) - <code>-l, --log-level</code>: Log level - <code>-o, --log-output</code>: Log output</p> <p>Examples:</p> <pre><code># Basic decryption\n.\\file-encryptor.exe decrypt -i sensitive-data.pdf.enc -k sensitive-data.pdf.key -o sensitive-data.pdf\n\n# Decrypt with checksum verification\n.\\file-encryptor.exe decrypt -i document.docx.enc -k document.docx.key -o document.docx --verify-checksum\n\n# Decrypt with debug logging\n.\\file-encryptor.exe decrypt -i file.bin.enc -k file.bin.key -o file.bin -l debug\n</code></pre>"},{"location":"guides/CLI_MODE_WINDOWS/#configuration-requirements","title":"Configuration Requirements","text":"<p>CLI mode requires minimal configuration - only Vault connection settings are needed.</p>"},{"location":"guides/CLI_MODE_WINDOWS/#minimal-configuration-for-cli-mode","title":"Minimal Configuration for CLI Mode","text":"<pre><code># config.hcl - Minimal configuration for CLI mode\n\nvault {\n  agent_address = \"http://127.0.0.1:8200\"\n  transit_mount = \"transit\"\n  key_name = \"file-encryption-key\"\n}\n\n# Logging configuration (optional)\nlogging {\n  level = \"info\"\n  format = \"text\"\n}\n</code></pre> <p>The following configuration sections are NOT required for CLI mode: - <code>encryption</code> (source/dest directories) - <code>decryption</code> (source/dest directories) - <code>queue</code> (state path, retries)</p>"},{"location":"guides/CLI_MODE_WINDOWS/#windows-specific-considerations","title":"Windows-Specific Considerations","text":""},{"location":"guides/CLI_MODE_WINDOWS/#path-separators","title":"Path Separators","text":"<p>Windows uses backslashes (<code>\\</code>) for paths, but the application accepts both:</p> <pre><code># Both work\n.\\file-encryptor.exe encrypt -i C:\\data\\file.txt -o C:\\encrypted\\file.enc\n.\\file-encryptor.exe encrypt -i C:/data/file.txt -o C:/encrypted/file.enc\n</code></pre>"},{"location":"guides/CLI_MODE_WINDOWS/#file-permissions","title":"File Permissions","text":"<p>On Windows, use <code>icacls</code> to set restrictive permissions:</p> <pre><code># Make key file readable only by current user\nicacls data.key /inheritance:r /grant:r \"%USERNAME%:R\"\n</code></pre>"},{"location":"guides/CLI_MODE_WINDOWS/#powershell-execution-policy","title":"PowerShell Execution Policy","text":"<p>If running scripts, you may need to adjust the execution policy:</p> <pre><code># Check current policy\nGet-ExecutionPolicy\n\n# Set to allow local scripts (run as Administrator)\nSet-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser\n</code></pre>"},{"location":"guides/CLI_MODE_WINDOWS/#environment-variables","title":"Environment Variables","text":"<p>Set environment variables in PowerShell:</p> <pre><code>$env:VAULT_ADDR = \"https://vault.example.com:8200\"\n$env:VAULT_TOKEN = \"your-token-here\"\n</code></pre> <p>Or use System Properties \u2192 Environment Variables for persistent settings.</p>"},{"location":"guides/CLI_MODE_WINDOWS/#powershell-script-integration","title":"PowerShell Script Integration","text":""},{"location":"guides/CLI_MODE_WINDOWS/#batch-encryption-example","title":"Batch Encryption Example","text":"<pre><code># encrypt-batch.ps1\n# Encrypt all files in a directory\n\nparam(\n    [string]$SourceDir = \"C:\\data\\source\",\n    [string]$DestDir = \"C:\\data\\encrypted\"\n)\n\n$files = Get-ChildItem -Path $SourceDir -File\n\nforeach ($file in $files) {\n    $filename = $file.Name\n    Write-Host \"Encrypting $filename...\"\n\n    &amp; .\\file-encryptor.exe encrypt `\n        -i $file.FullName `\n        -o \"$DestDir\\$filename.enc\" `\n        -k \"$DestDir\\$filename.key\" `\n        --checksum\n\n    if ($LASTEXITCODE -eq 0) {\n        Write-Host \"[OK] $filename encrypted successfully\" -ForegroundColor Green\n    } else {\n        Write-Host \"[FAILED] Failed to encrypt $filename\" -ForegroundColor Red\n    }\n}\n</code></pre> <p>Usage: <pre><code>.\\encrypt-batch.ps1 -SourceDir \"C:\\data\\source\" -DestDir \"C:\\data\\encrypted\"\n</code></pre></p>"},{"location":"guides/CLI_MODE_WINDOWS/#batch-decryption-example","title":"Batch Decryption Example","text":"<pre><code># decrypt-batch.ps1\n# Decrypt all .enc files in a directory\n\nparam(\n    [string]$SourceDir = \"C:\\data\\encrypted\",\n    [string]$DestDir = \"C:\\data\\decrypted\"\n)\n\n$encFiles = Get-ChildItem -Path $SourceDir -Filter \"*.enc\"\n\nforeach ($encFile in $encFiles) {\n    $filename = $encFile.BaseName  # Remove .enc extension\n    $keyFile = \"$($encFile.FullName.Replace('.enc', '.key'))\"\n\n    if (-not (Test-Path $keyFile)) {\n        Write-Host \"[ERROR] Key file not found for $filename\" -ForegroundColor Red\n        continue\n    }\n\n    Write-Host \"Decrypting $filename...\"\n\n    &amp; .\\file-encryptor.exe decrypt `\n        -i $encFile.FullName `\n        -k $keyFile `\n        -o \"$DestDir\\$filename\" `\n        --verify-checksum\n\n    if ($LASTEXITCODE -eq 0) {\n        Write-Host \"[OK] $filename decrypted successfully\" -ForegroundColor Green\n    } else {\n        Write-Host \"[FAILED] Failed to decrypt $filename\" -ForegroundColor Red\n    }\n}\n</code></pre> <p>Usage: <pre><code>.\\decrypt-batch.ps1 -SourceDir \"C:\\data\\encrypted\" -DestDir \"C:\\data\\decrypted\"\n</code></pre></p>"},{"location":"guides/CLI_MODE_WINDOWS/#progress-reporting","title":"Progress Reporting","text":"<p>For large files, progress is logged every 20%:</p> <pre><code>2025-11-05T10:30:45Z [INFO] Encrypting file input=largefile.bin output=largefile.bin.enc\n2025-11-05T10:30:46Z [INFO] Encryption progress percent=20\n2025-11-05T10:30:47Z [INFO] Encryption progress percent=40\n2025-11-05T10:30:48Z [INFO] Encryption progress percent=60\n2025-11-05T10:30:49Z [INFO] Encryption progress percent=80\n2025-11-05T10:30:50Z [INFO] Encryption progress percent=100\n2025-11-05T10:30:50Z [INFO] File encrypted successfully input=largefile.bin output=largefile.bin.enc\n</code></pre>"},{"location":"guides/CLI_MODE_WINDOWS/#error-handling","title":"Error Handling","text":""},{"location":"guides/CLI_MODE_WINDOWS/#common-errors-and-solutions","title":"Common Errors and Solutions","text":"<p>Error: <code>input file not found</code> <pre><code>Solution: Verify the input file path is correct. Use absolute paths or ensure current directory is correct.\nExample: .\\file-encryptor.exe encrypt -i C:\\full\\path\\to\\file.txt -o C:\\output\\file.enc\n</code></pre></p> <p>Error: <code>failed to load configuration</code> <pre><code>Solution: Ensure config file exists and contains valid Vault settings\nExample: .\\file-encryptor.exe encrypt -i file.txt -o file.enc -c C:\\path\\to\\config.hcl\n</code></pre></p> <p>Error: <code>vault health check failed</code> <pre><code>Solution: Ensure Vault Agent is running and accessible at the configured address\nCheck: netstat -an | findstr \"8200\" to verify port is listening\n</code></pre></p> <p>Error: <code>failed to generate data key</code> <pre><code>Solution: Check Vault connectivity and ensure the transit key exists and you have permission\n</code></pre></p> <p>Error: <code>checksum verification failed</code> <pre><code>Solution: The decrypted file may be corrupted or tampered with\n</code></pre></p>"},{"location":"guides/CLI_MODE_WINDOWS/#testing-cli-mode","title":"Testing CLI Mode","text":""},{"location":"guides/CLI_MODE_WINDOWS/#powershell-integration-test","title":"PowerShell Integration Test","text":"<pre><code># test-cli.ps1\n# Integration test for CLI mode\n\n$ErrorActionPreference = \"Stop\"\n\nWrite-Host \"Testing CLI mode...\"\n\n# Test encryption\n\"secret data\" | Out-File -FilePath test.txt -Encoding ASCII -NoNewline\n.\\file-encryptor.exe encrypt -i test.txt -o test.txt.enc --checksum\n\nif ($LASTEXITCODE -ne 0) {\n    Write-Host \"[ERROR] Encryption failed\" -ForegroundColor Red\n    exit 1\n}\nWrite-Host \"[OK] Encryption successful\" -ForegroundColor Green\n\n# Verify files exist\nif (-not (Test-Path test.txt.enc)) {\n    Write-Host \"[ERROR] Encrypted file not created\" -ForegroundColor Red\n    exit 1\n}\nWrite-Host \"[OK] Encrypted file created\" -ForegroundColor Green\n\nif (-not (Test-Path test.txt.key)) {\n    Write-Host \"[ERROR] Key file not created\" -ForegroundColor Red\n    exit 1\n}\nWrite-Host \"[OK] Key file created\" -ForegroundColor Green\n\nif (-not (Test-Path test.txt.sha256)) {\n    Write-Host \"[ERROR] Checksum file not created\" -ForegroundColor Red\n    exit 1\n}\nWrite-Host \"[OK] Checksum file created\" -ForegroundColor Green\n\n# Test decryption\n.\\file-encryptor.exe decrypt -i test.txt.enc -k test.txt.key -o test-decrypted.txt --verify-checksum\n\nif ($LASTEXITCODE -ne 0) {\n    Write-Host \"[ERROR] Decryption failed\" -ForegroundColor Red\n    exit 1\n}\nWrite-Host \"[OK] Decryption successful\" -ForegroundColor Green\n\n# Verify content\n$original = Get-Content test.txt -Raw\n$decrypted = Get-Content test-decrypted.txt -Raw\n\nif ($original -eq $decrypted) {\n    Write-Host \"[OK] Decrypted content matches original\" -ForegroundColor Green\n} else {\n    Write-Host \"[ERROR] Decrypted content does not match\" -ForegroundColor Red\n    exit 1\n}\n\n# Cleanup\nRemove-Item test.txt, test.txt.enc, test.txt.key, test.txt.sha256, test-decrypted.txt\n\nWrite-Host \"[OK] All CLI tests passed\" -ForegroundColor Green\n</code></pre> <p>Usage: <pre><code>.\\test-cli.ps1\n</code></pre></p>"},{"location":"guides/CLI_MODE_WINDOWS/#performance-considerations","title":"Performance Considerations","text":"<ul> <li>Streaming: Files are processed in 1MB chunks, memory usage is constant regardless of file size</li> <li>Progress: Updates logged every 20% to track long-running operations</li> <li>No Queue: CLI mode bypasses the queue system for immediate processing</li> <li>Single Operation: Each command processes exactly one file then exits</li> </ul>"},{"location":"guides/CLI_MODE_WINDOWS/#security-considerations","title":"Security Considerations","text":"<ol> <li>Key File Security: The <code>.key</code> files contain encrypted DEKs and should be stored securely</li> <li>Permissions: Use <code>icacls</code> to set restrictive permissions on encrypted files and keys</li> <li>Cleanup: Ensure the original file is handled securely after encryption (delete or move to secure location)</li> <li>Logging: Be careful not to log sensitive file paths or content</li> <li>Memory: Plaintext DEKs are zeroed from memory after use</li> </ol>"},{"location":"guides/CLI_MODE_WINDOWS/#windows-service-mode","title":"Windows Service Mode","text":"<p>For running as a Windows Service, hot-reload is not supported. To change configuration:</p> <ol> <li>Stop the service</li> <li>Update configuration file</li> <li>Restart the service</li> </ol> <p>Stopping service (PowerShell as Administrator): <pre><code>Stop-Process -Name \"file-encryptor\" -Force\n</code></pre></p> <p>Or press <code>Ctrl+C</code> if running in foreground.</p>"},{"location":"guides/CLI_MODE_WINDOWS/#comparison-cli-mode-vs-service-mode","title":"Comparison: CLI Mode vs Service Mode","text":"Feature CLI Mode Service Mode Use Case One-off operations Continuous monitoring Queue No Yes (FIFO with persistence) Retry Logic No Yes (exponential backoff) File Watching No Yes (fsnotify) Configuration Minimal (Vault only) Full (directories, queue, etc.) Graceful Shutdown N/A (exits immediately) Yes (saves queue state) Hot Reload No No (Windows limitation) Batch Processing Via PowerShell scripts Automatic Progress Reporting Logged to console Logged to file/stdout"},{"location":"guides/CLI_MODE_WINDOWS/#exit-codes","title":"Exit Codes","text":"<ul> <li><code>0</code>: Success</li> <li><code>1</code>: General error (file not found, encryption/decryption failed, etc.)</li> <li><code>2</code>: Configuration error</li> <li><code>3</code>: Vault connection error</li> </ul> <p>Use in PowerShell: <pre><code>.\\file-encryptor.exe encrypt -i file.txt -o file.enc\nif ($LASTEXITCODE -eq 0) {\n    Write-Host \"Success\"\n} else {\n    Write-Host \"Failed with exit code $LASTEXITCODE\"\n}\n</code></pre></p>"},{"location":"guides/CLI_MODE_WINDOWS/#additional-resources","title":"Additional Resources","text":"<ul> <li>Windows Installation Guide</li> <li>Configuration Guide</li> <li>Vault Setup for Windows</li> <li>Main CLI Mode Guide (Unix/Linux/macOS)</li> </ul> <p>For questions specific to Windows deployment, please open an issue on GitHub with the <code>windows</code> label.</p>"},{"location":"guides/REWRAP_GUIDE/","title":"Key Re-wrapping Guide","text":"<p>Platform Note: This guide includes examples for both Unix/Linux/macOS (bash) and Windows (PowerShell). All features work identically on all platforms.</p>"},{"location":"guides/REWRAP_GUIDE/#overview","title":"Overview","text":"<p>Key re-wrapping is a security best practice that allows you to rotate encrypted data encryption keys (DEKs) to newer versions of your Vault Transit encryption key without re-encrypting your actual data files.</p> <p>When you rotate your Vault Transit key, new encryptions use the latest version, but old encrypted DEKs remain at their original version. Re-wrapping updates these DEKs to the latest key version, improving your security posture.</p>"},{"location":"guides/REWRAP_GUIDE/#key-concepts","title":"Key Concepts","text":""},{"location":"guides/REWRAP_GUIDE/#what-gets-updated","title":"What Gets Updated","text":"<ul> <li><code>.key</code> files: Updated with new ciphertext using the latest Vault key version</li> <li><code>.enc</code> files: Remain unchanged (no re-encryption needed)</li> </ul>"},{"location":"guides/REWRAP_GUIDE/#why-re-wrap","title":"Why Re-wrap?","text":"<ul> <li>Comply with key rotation policies</li> <li>Migrate to stronger encryption versions after key upgrades</li> <li>Maintain consistent key versions across your encrypted data estate</li> </ul>"},{"location":"guides/REWRAP_GUIDE/#how-it-works","title":"How It Works","text":"<ol> <li>Read the encrypted DEK from the <code>.key</code> file</li> <li>Send it to Vault Transit's <code>/rewrap</code> endpoint</li> <li>Vault decrypts and re-encrypts the DEK with the latest key version</li> <li>Atomically update the <code>.key</code> file with new ciphertext</li> <li>Original <code>.enc</code> file remains valid and unchanged</li> </ol>"},{"location":"guides/REWRAP_GUIDE/#command-reference","title":"Command Reference","text":""},{"location":"guides/REWRAP_GUIDE/#basic-usage","title":"Basic Usage","text":"<p>Windows users: Replace <code>file-encryptor</code> with <code>file-encryptor.exe</code> and use backslashes or forward slashes for paths.</p>"},{"location":"guides/REWRAP_GUIDE/#re-wrap-a-single-key-file","title":"Re-wrap a Single Key File","text":"<pre><code># Unix/Linux/macOS\nfile-encryptor rewrap \\\n  --key-file /path/to/data.txt.key \\\n  --min-version 2\n</code></pre> <pre><code># Windows\n.\\file-encryptor.exe rewrap `\n  --key-file C:\\path\\to\\data.txt.key `\n  --min-version 2\n</code></pre>"},{"location":"guides/REWRAP_GUIDE/#re-wrap-all-keys-in-a-directory","title":"Re-wrap All Keys in a Directory","text":"<pre><code># Unix/Linux/macOS - Non-recursive (current directory only)\nfile-encryptor rewrap \\\n  --dir /path/to/keys \\\n  --min-version 2\n\n# Unix/Linux/macOS - Recursive (include subdirectories)\nfile-encryptor rewrap \\\n  --dir /path/to/keys \\\n  --recursive \\\n  --min-version 2\n</code></pre> <pre><code># Windows - Non-recursive\n.\\file-encryptor.exe rewrap `\n  --dir C:\\path\\to\\keys `\n  --min-version 2\n\n# Windows - Recursive\n.\\file-encryptor.exe rewrap `\n  --dir C:\\path\\to\\keys `\n  --recursive `\n  --min-version 2\n</code></pre>"},{"location":"guides/REWRAP_GUIDE/#advanced-options","title":"Advanced Options","text":""},{"location":"guides/REWRAP_GUIDE/#dry-run-mode","title":"Dry-Run Mode","text":"<p>Preview what would be re-wrapped without making changes: <pre><code>file-encryptor rewrap \\\n  --dir /path/to/keys \\\n  --recursive \\\n  --dry-run \\\n  --min-version 2\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#disable-backups","title":"Disable Backups","text":"<p>By default, backups are created (<code>.key.bak</code>). To disable: <pre><code>file-encryptor rewrap \\\n  --dir /path/to/keys \\\n  --min-version 2 \\\n  --backup=false\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#output-formats","title":"Output Formats","text":"<p>Text (default) - Human-readable summary: <pre><code>file-encryptor rewrap --dir /path/to/keys --min-version 2\n</code></pre> Output: <pre><code>Re-wrap Summary:\n  Total files: 50\n  Successfully re-wrapped: 48\n  Skipped (already at min version): 2\n  Failed: 0\n\nVersion Distribution:\n  Version 1: 15 files\n  Version 2: 33 files\n  Version 3: 2 files\n</code></pre></p> <p>JSON - Machine-readable with full details: <pre><code>file-encryptor rewrap --dir /path/to/keys --min-version 2 --format json\n</code></pre></p> <p>CSV - Spreadsheet-compatible export: <pre><code>file-encryptor rewrap --dir /path/to/keys --min-version 2 --format csv &gt; rewrap-results.csv\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#flags-reference","title":"Flags Reference","text":"Flag Short Description Default <code>--key-file</code> <code>-k</code> Single key file to re-wrap - <code>--dir</code> <code>-d</code> Directory containing key files - <code>--recursive</code> <code>-r</code> Scan subdirectories recursively <code>false</code> <code>--dry-run</code> - Preview changes without modifying files <code>false</code> <code>--min-version</code> <code>-m</code> Minimum key version to require <code>1</code> <code>--backup</code> <code>-b</code> Create backups before re-wrapping <code>true</code> <code>--format</code> <code>-f</code> Output format: <code>text</code>, <code>json</code>, <code>csv</code> <code>text</code> <code>--config</code> <code>-c</code> Configuration file path <code>config.hcl</code> <code>--log-level</code> <code>-l</code> Log level: <code>debug</code>, <code>info</code>, <code>error</code> <code>info</code>"},{"location":"guides/REWRAP_GUIDE/#workflows","title":"Workflows","text":""},{"location":"guides/REWRAP_GUIDE/#1-audit-current-key-versions","title":"1. Audit Current Key Versions","text":"<p>Before re-wrapping, check current key version distribution using the <code>key-versions</code> command: <pre><code># Unix/Linux/macOS\n# Display version statistics without making changes (no config needed)\nfile-encryptor key-versions \\\n  --dir /data/keys \\\n  --recursive\n\n# Output as JSON for automated analysis\nfile-encryptor key-versions \\\n  --dir /data/keys \\\n  --recursive \\\n  --format json\n</code></pre></p> <pre><code># Windows\n# Display version statistics without making changes (no config needed)\n.\\file-encryptor.exe key-versions `\n  --dir C:\\data\\keys `\n  --recursive\n\n# Output as JSON for automated analysis\n.\\file-encryptor.exe key-versions `\n  --dir C:\\data\\keys `\n  --recursive `\n  --format json\n</code></pre> <p>Note: The <code>key-versions</code> command does not require a configuration file or Vault access - it only parses local <code>.key</code> files. This makes it faster and suitable for offline auditing.</p>"},{"location":"guides/REWRAP_GUIDE/#2-re-wrap-with-safety-checks","title":"2. Re-wrap with Safety Checks","text":"<p>Perform re-wrapping with backups enabled (default): <pre><code>file-encryptor rewrap \\\n  --dir /data/keys \\\n  --recursive \\\n  --min-version 3 \\\n  --backup\n</code></pre></p> <p>Backups are created at <code>&lt;key-file&gt;.bak</code>. If re-wrapping fails, restore with: <pre><code>cp /path/to/file.key.bak /path/to/file.key\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#3-bulk-re-wrap-for-compliance","title":"3. Bulk Re-wrap for Compliance","text":"<p>Export results for audit trail: <pre><code>file-encryptor rewrap \\\n  --dir /data/keys \\\n  --recursive \\\n  --min-version 4 \\\n  --format csv \\\n  &gt; rewrap-audit-$(date +%Y%m%d).csv\n</code></pre></p> <p>CSV columns: - <code>FilePath</code>: Path to the <code>.key</code> file - <code>OldVersion</code>: Version before re-wrap - <code>NewVersion</code>: Version after re-wrap - <code>Status</code>: <code>success</code>, <code>skipped</code>, or <code>failed</code> - <code>BackupCreated</code>: <code>true</code> or <code>false</code> - <code>Error</code>: Error message if failed</p>"},{"location":"guides/REWRAP_GUIDE/#4-scheduled-re-wrapping","title":"4. Scheduled Re-wrapping","text":"<p>Create a cron job to regularly re-wrap keys: <pre><code># Daily re-wrap at 2 AM\n0 2 * * * /usr/local/bin/file-encryptor rewrap \\\n  --dir /data/keys \\\n  --recursive \\\n  --min-version 2 \\\n  --format json \\\n  &gt;&gt; /var/log/rewrap-$(date +\\%Y\\%m).log 2&gt;&amp;1\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#best-practices","title":"Best Practices","text":""},{"location":"guides/REWRAP_GUIDE/#1-always-test-first","title":"1. Always Test First","text":"<p>Use <code>--dry-run</code> before production re-wrapping: <pre><code>file-encryptor rewrap --dir /data/keys --dry-run --min-version 3\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#2-keep-backups-enabled","title":"2. Keep Backups Enabled","text":"<p>Unless you have a strong reason, keep backups enabled: - Default <code>.bak</code> files allow quick rollback - Backups are overwritten on subsequent re-wraps - Remove backups manually after verification</p>"},{"location":"guides/REWRAP_GUIDE/#3-monitor-re-wrap-operations","title":"3. Monitor Re-wrap Operations","text":"<p>Use structured logging for audit trails: <pre><code>file-encryptor rewrap \\\n  --dir /data/keys \\\n  --recursive \\\n  --min-version 3 \\\n  --log-level info \\\n  --log-output /var/log/rewrap.log\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#4-set-appropriate-min-version","title":"4. Set Appropriate Min Version","text":"<ul> <li>Check current Vault key version: <code>vault read transit/keys/file-encryption-key</code></li> <li>Set <code>--min-version</code> to your organization's policy requirement</li> <li>Keys already at or above min version are skipped (no unnecessary Vault calls)</li> </ul>"},{"location":"guides/REWRAP_GUIDE/#5-handle-failures-gracefully","title":"5. Handle Failures Gracefully","text":"<p>Re-wrap operations continue on individual file failures: - Failed files are logged with error details - Exit code <code>1</code> = partial success (some failures) - Exit code <code>2</code> = complete failure (all files failed) - Exit code <code>0</code> = complete success</p>"},{"location":"guides/REWRAP_GUIDE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/REWRAP_GUIDE/#issue-key-file-already-at-minimum-version","title":"Issue: \"Key file already at minimum version\"","text":"<p>Symptom: Files are skipped, no re-wrapping occurs</p> <p>Solution: Check current key versions and increase <code>--min-version</code>: <pre><code># Check Vault key version\nvault read transit/keys/file-encryption-key\n\n# Adjust min-version accordingly\nfile-encryptor rewrap --dir /data/keys --min-version 4\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#issue-failed-to-rewrap-permission-denied","title":"Issue: \"Failed to rewrap: permission denied\"","text":"<p>Symptom: Vault returns 403 errors</p> <p>Solution: Ensure Vault policy allows <code>rewrap</code> capability: <pre><code># Vault policy\npath \"transit/rewrap/file-encryption-key\" {\n  capabilities = [\"update\"]\n}\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#issue-file-system-permission-denied","title":"Issue: \"File system permission denied\"","text":"<p>Symptom: Cannot write updated <code>.key</code> file</p> <p>Solution: Check file permissions: <pre><code># Ensure key files are writable\nchmod 600 /path/to/*.key\n\n# Ensure directory is writable (for temp files)\nchmod 700 /path/to/keys\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#issue-dry-run-shows-changes-but-actual-run-skips-files","title":"Issue: \"Dry-run shows changes but actual run skips files\"","text":"<p>Symptom: Files reported as needing re-wrap in dry-run but skipped in actual run</p> <p>Solution: Check if files were already re-wrapped between runs: <pre><code># Check actual key version\ngrep -oE 'vault:v[0-9]+' /path/to/file.key\n\n# Compare with min-version parameter\nfile-encryptor rewrap --key-file /path/to/file.key --min-version 3\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#security-considerations","title":"Security Considerations","text":""},{"location":"guides/REWRAP_GUIDE/#1-atomic-updates","title":"1. Atomic Updates","text":"<p>Re-wrap uses atomic file operations: - Write to temporary file - Sync to disk (<code>fsync</code>) - Rename to target (atomic on POSIX) - Rollback on failure using backup</p>"},{"location":"guides/REWRAP_GUIDE/#2-memory-safety","title":"2. Memory Safety","text":"<p>Plaintext DEKs are never stored during re-wrap: - Vault handles decryption and re-encryption internally - Only ciphertext is transmitted and stored - No plaintext DEK touches disk or application memory</p>"},{"location":"guides/REWRAP_GUIDE/#3-audit-logging","title":"3. Audit Logging","text":"<p>Enable audit logging to track re-wrap operations: <pre><code># config.hcl\naudit_log {\n  enabled = true\n  path    = \"/var/log/file-encryptor-audit.log\"\n}\n</code></pre></p>"},{"location":"guides/REWRAP_GUIDE/#performance","title":"Performance","text":""},{"location":"guides/REWRAP_GUIDE/#batch-performance","title":"Batch Performance","text":"<ul> <li>Small batches (&lt;100 files): ~2-5 seconds</li> <li>Medium batches (100-1000 files): ~30-60 seconds</li> <li>Large batches (1000+ files): ~5-10 minutes</li> </ul> <p>Performance factors: - Vault network latency - Number of Vault requests (1 per file) - File system I/O for atomic writes - Backup creation overhead</p>"},{"location":"guides/REWRAP_GUIDE/#optimization-tips","title":"Optimization Tips","text":"<ol> <li>Use --backup=false if you have external backups (saves I/O)</li> <li>Run during off-peak hours to minimize Vault load</li> <li>Split large directories for parallel processing:    <pre><code># Process different subdirectories in parallel\nfile-encryptor rewrap --dir /data/keys/2024 --min-version 3 &amp;\nfile-encryptor rewrap --dir /data/keys/2023 --min-version 3 &amp;\nwait\n</code></pre></li> </ol>"},{"location":"guides/REWRAP_GUIDE/#integration-examples","title":"Integration Examples","text":""},{"location":"guides/REWRAP_GUIDE/#cicd-pipeline","title":"CI/CD Pipeline","text":"<pre><code># .github/workflows/key-rotation.yml\nname: Monthly Key Re-wrap\non:\n  schedule:\n    - cron: '0 2 1 * *'  # First day of month at 2 AM\n\njobs:\n  rewrap:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Re-wrap encryption keys\n        env:\n          VAULT_ADDR: ${{ secrets.VAULT_ADDR }}\n          VAULT_TOKEN: ${{ secrets.VAULT_TOKEN }}\n        run: |\n          file-encryptor rewrap \\\n            --dir ./encrypted-keys \\\n            --recursive \\\n            --min-version 2 \\\n            --format json \\\n            &gt; rewrap-results.json\n\n      - name: Upload results\n        uses: actions/upload-artifact@v3\n        with:\n          name: rewrap-results\n          path: rewrap-results.json\n</code></pre>"},{"location":"guides/REWRAP_GUIDE/#monitoring-script","title":"Monitoring Script","text":"<pre><code>#!/bin/bash\n# monitor-key-versions.sh\n\nset -e\n\nKEYS_DIR=\"/data/encrypted/keys\"\nMIN_VERSION=3\nALERT_THRESHOLD=10  # Alert if more than 10 files need rewrapping\n\n# Dry-run to check what needs rewrapping\nRESULT=$(file-encryptor rewrap \\\n  --dir \"${KEYS_DIR}\" \\\n  --recursive \\\n  --dry-run \\\n  --min-version \"${MIN_VERSION}\" \\\n  --format json)\n\n# Parse JSON to count files needing rewrap\nNEEDS_REWRAP=$(echo \"${RESULT}\" | jq '.successful')\n\nif [ \"${NEEDS_REWRAP}\" -gt \"${ALERT_THRESHOLD}\" ]; then\n  echo \"WARNING: ${NEEDS_REWRAP} key files need re-wrapping to version ${MIN_VERSION}\"\n  # Send alert (e.g., Slack, PagerDuty, email)\n  exit 1\nfi\n\necho \"OK: Only ${NEEDS_REWRAP} files need re-wrapping (threshold: ${ALERT_THRESHOLD})\"\n</code></pre>"},{"location":"guides/REWRAP_GUIDE/#see-also","title":"See Also","text":"<ul> <li>CLI Mode Guide - General CLI usage</li> <li>Architecture Documentation - Technical details</li> <li>Vault Setup Guide - Vault configuration</li> <li>Vault Enterprise Setup Guide - Enterprise-specific setup</li> </ul>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/","title":"Vault Enterprise Setup Guide - Local Dev Mode","text":"<p>Note: This guide is for Vault Enterprise (self-hosted) on Unix, Linux, and macOS platforms. For HCP Vault setup, see VAULT_SETUP_GUIDE.md.</p> <p>This guide walks you through setting up a local Vault Enterprise instance in dev mode for the file-encryptor application.</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#overview","title":"Overview","text":"<p>The file-encryptor application with Vault Enterprise uses: - Vault Enterprise (self-hosted, dev mode) for key management - Vault Transit Engine for envelope encryption - Certificate Authentication via Vault Agent - Vault Agent as a local proxy with caching</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#important-dev-mode-vs-production","title":"Important: Dev Mode vs Production","text":"<p>This guide uses Vault dev mode, which is designed for development and testing ONLY:</p> <ul> <li>\u2713 Quick to start (no configuration needed)</li> <li>\u2713 Auto-unsealed</li> <li>\u2713 In-memory storage</li> <li>\u2717 Data lost on restart</li> <li>\u2717 NOT secure for production</li> <li>\u2717 No persistence</li> </ul> <p>For production Vault Enterprise deployments, consult the Vault Enterprise Production Deployment Guide.</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#prerequisites","title":"Prerequisites","text":"<p>Before starting, ensure you have:</p> <ol> <li>Vault Binary: Vault Community Edition or Enterprise Edition installed</li> <li>Download from: https://developer.hashicorp.com/vault/downloads</li> <li>Verify: <code>vault version</code></li> <li>OpenSSL: For certificate generation</li> <li>Verify: <code>openssl version</code></li> </ol> <p>Authentication: Vault Enterprise uses certificate-based authentication via Vault Agent. Token authentication is used for HCP Vault (see the HCP guide).</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#quick-start","title":"Quick Start","text":""},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#1-start-vault-in-dev-mode","title":"1. Start Vault in Dev Mode","text":"<pre><code>cd scripts/vault-setup-enterprise\n./01-start-vault-dev.sh\n</code></pre> <p>This starts Vault on <code>http://127.0.0.1:8200</code> with a root token.</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#2-configure-vault","title":"2. Configure Vault","text":"<p>In a new terminal:</p> <pre><code>cd scripts/vault-setup-enterprise\n./02-configure-vault.sh\n</code></pre> <p>This script: - Enables Transit engine - Creates encryption key - Generates test certificates - Configures certificate authentication - Creates application policy</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#3-test-the-setup","title":"3. Test the Setup","text":"<pre><code>cd scripts/vault-setup-enterprise\n./03-test-setup.sh\n</code></pre> <p>This verifies: - Certificate authentication works - Data key generation works - Policy permissions are correct</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#4-start-vault-agent","title":"4. Start Vault Agent","text":"<p>In a new terminal:</p> <pre><code>vault agent -config=configs/vault-agent/vault-agent-enterprise-dev.hcl\n</code></pre> <p>Leave this running. The file-encryptor application will connect to the agent at <code>http://127.0.0.1:8210</code>.</p> <p>Note: Enterprise Vault Agent uses port 8210 (not 8200) to avoid conflicts with HCP Vault Agent, if it's running.</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#5-run-file-encryptor","title":"5. Run File Encryptor","text":"<pre><code># Encrypt a file\n./bin/file-encryptor encrypt \\\n  -i test.txt \\\n  -o test.txt.enc \\\n  -c configs/examples/example-enterprise.hcl\n\n# Decrypt a file\n./bin/file-encryptor decrypt \\\n  -i test.txt.enc \\\n  -k test.txt.key \\\n  -o test-decrypted.txt \\\n  -c configs/examples/example-enterprise.hcl\n</code></pre>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#what-gets-created","title":"What Gets Created","text":""},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#transit-engine","title":"Transit Engine","text":"<ul> <li>Mount Path: <code>transit/</code></li> <li>Key Name: <code>file-encryption-key</code></li> <li>Key Type: AES-256-GCM</li> <li>Configuration: Non-exportable, deletion protection enabled</li> </ul>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#certificate-authentication","title":"Certificate Authentication","text":"<ul> <li>Mount Path: <code>auth/cert/</code></li> <li>Role Name: <code>file-encryptor</code></li> <li>Allowed CN: <code>file-encryptor.local</code></li> <li>CA Certificate: Self-signed (test only)</li> <li>Client Certificate: Generated locally</li> </ul>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#vault-policy","title":"Vault Policy","text":"<ul> <li>Name: <code>file-encryptor-policy</code></li> <li>Permissions:</li> <li>[ALLOW] Generate plaintext data keys</li> <li>[ALLOW] Decrypt data keys</li> <li>[ALLOW] Read key metadata</li> <li>[DENY] Direct encrypt/decrypt (enforces envelope encryption)</li> </ul>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#architecture","title":"Architecture","text":"<pre><code>[File Encryptor]\n[ Application  ]\n       |\n       | http://127.0.0.1:8210\n       v\n[  Vault Agent   ] &lt;--- Auto-auth with client cert\n[ (Local Proxy)  ]\n       |\n       | HTTP (dev mode, no TLS)\n       v\n[Vault Dev Server]\n[ localhost:8200 ]\n[                ]\n[ * Transit Engine]\n[ * Cert Auth    ]\n[ * Policies     ]\n</code></pre>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#security-model","title":"Security Model","text":""},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#envelope-encryption-flow","title":"Envelope Encryption Flow","text":"<ol> <li>Application requests plaintext data key from Vault</li> <li>Vault generates random DEK and returns both plaintext and encrypted versions</li> <li>Application encrypts file locally with plaintext DEK (AES-256-GCM)</li> <li>Application saves encrypted DEK to <code>.key</code> file</li> <li>Application zeros plaintext DEK from memory</li> <li>Only encrypted DEK and ciphertext are stored</li> </ol>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#certificate-authentication_1","title":"Certificate Authentication","text":"<ul> <li>Vault Agent authenticates using client certificate</li> <li>Client certificate signed by CA uploaded to Vault</li> <li>Certificate CN must match allowed list in Vault role</li> <li>Vault Agent manages token lifecycle</li> <li>Application never handles certificates directly</li> </ul>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#detailed-setup-steps","title":"Detailed Setup Steps","text":""},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#step-1-start-vault-dev-server","title":"Step 1: Start Vault Dev Server","text":"<p>The <code>01-start-vault-dev.sh</code> script does:</p> <pre><code># Start Vault in dev mode\nvault server -dev \\\n  -dev-root-token-id=\"dev-root-token\" \\\n  -dev-listen-address=\"127.0.0.1:8200\"\n</code></pre> <p>Key features: - Root token: <code>dev-root-token</code> (configurable) - Address: <code>http://127.0.0.1:8200</code> - Auto-unsealed - In-memory storage - HTTP only (no TLS in dev mode)</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#step-2-configure-transit-and-auth","title":"Step 2: Configure Transit and Auth","text":"<p>The <code>02-configure-vault.sh</code> script does:</p> <ol> <li> <p>Enable Transit Engine:    <pre><code>vault secrets enable -path=transit transit\n</code></pre></p> </li> <li> <p>Create Encryption Key:    <pre><code>vault write -f transit/keys/file-encryption-key \\\n  type=aes256-gcm96 \\\n  deletion_allowed=false \\\n  exportable=false\n</code></pre></p> </li> <li> <p>Generate Certificates (reuses existing script):    <pre><code>cd ../../test-certs\n./generate-certs.sh\ncd ../vault-setup-enterprise\n</code></pre></p> </li> <li> <p>Configure Certificate Auth:    <pre><code># Enable cert auth\nvault auth enable cert\n\n# Upload CA certificate\nvault write auth/cert/certs/file-encryptor \\\n  certificate=@../../test-certs/ca.crt \\\n  allowed_common_names=\"file-encryptor.local\" \\\n  token_policies=\"file-encryptor-policy\"\n</code></pre></p> </li> <li> <p>Create Policy:    <pre><code>vault policy write file-encryptor-policy - &lt;&lt;EOF\n# Allow generating data keys\npath \"transit/datakey/plaintext/file-encryption-key\" {\n  capabilities = [\"create\", \"update\"]\n}\n\n# Allow decrypting data keys\npath \"transit/decrypt/file-encryption-key\" {\n  capabilities = [\"create\", \"update\"]\n}\n\n# Deny direct encrypt/decrypt\npath \"transit/encrypt/file-encryption-key\" {\n  capabilities = [\"deny\"]\n}\nEOF\n</code></pre></p> </li> </ol>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#step-3-test-setup","title":"Step 3: Test Setup","text":"<p>The <code>03-test-setup.sh</code> script verifies:</p> <ol> <li> <p>Certificate Authentication:    <pre><code>vault login -method=cert \\\n  -client-cert=../../test-certs/client.crt \\\n  -client-key=../../test-certs/client-key.pem\n</code></pre></p> </li> <li> <p>Data Key Generation:    <pre><code>vault write -f transit/datakey/plaintext/file-encryption-key\n</code></pre></p> </li> <li> <p>Data Key Decryption:    <pre><code>vault write transit/decrypt/file-encryption-key \\\n  ciphertext=\"vault:v1:...\"\n</code></pre></p> </li> </ol>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#vault-dev-server-wont-start","title":"Vault Dev Server Won't Start","text":"<p>Symptom: <code>address already in use</code></p> <p>Solutions: 1. Check if Vault is already running: <code>ps aux | grep vault</code> 2. Kill existing process: <code>pkill vault</code> 3. Check port 8200: <code>lsof -i :8200</code> 4. Start on different port: <code>vault server -dev -dev-listen-address=\"127.0.0.1:8201\"</code></p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#certificate-authentication-fails","title":"Certificate Authentication Fails","text":"<p>Symptom: <code>permission denied</code> when using cert auth</p> <p>Solutions: 1. Verify CA cert uploaded: <code>vault read auth/cert/certs/file-encryptor</code> 2. Check certificate CN: <code>openssl x509 -in scripts/test-certs/client.crt -noout -subject</code> 3. Should show: <code>CN = file-encryptor.local</code> 4. Ensure certificate not expired: <code>openssl x509 -in scripts/test-certs/client.crt -noout -dates</code> 5. Regenerate certificates: <code>cd scripts/test-certs &amp;&amp; ./generate-certs.sh</code></p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#vault-agent-connection-issues","title":"Vault Agent Connection Issues","text":"<p>Symptom: Agent can't connect to Vault</p> <p>Solutions: 1. Verify Vault is running: <code>vault status</code> 2. Check address: <code>http://127.0.0.1:8200</code> 3. Verify in vault-agent config: <code>vault.address = \"http://127.0.0.1:8200\"</code> 4. Check Vault Agent logs for errors</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#permission-denied-on-operations","title":"Permission Denied on Operations","text":"<p>Symptom: Application can authenticate but operations fail</p> <p>Solutions: 1. Check assigned policies: <code>vault token lookup</code> 2. Verify policy content: <code>vault policy read file-encryptor-policy</code> 3. Test with Vault CLI using cert auth 4. Ensure policy allows datakey operations</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#data-lost-after-restart","title":"Data Lost After Restart","text":"<p>Symptom: Vault starts but transit key missing</p> <p>Explanation: This is expected in dev mode. Data is in-memory only.</p> <p>Solutions: 1. Run <code>02-configure-vault.sh</code> again to recreate configuration 2. For persistence, use file-based storage (see Production Considerations)</p>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#testing-the-setup","title":"Testing the Setup","text":""},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#manual-test-full-workflow","title":"Manual Test: Full Workflow","text":"<pre><code># Terminal 1: Start Vault\ncd scripts/vault-setup-enterprise\n./01-start-vault-dev.sh\n\n# Terminal 2: Configure Vault\ncd scripts/vault-setup-enterprise\n./02-configure-vault.sh\n\n# Terminal 3: Start Vault Agent\nvault agent -config=configs/vault-agent/vault-agent-enterprise-dev.hcl\n\n# Terminal 4: Test file encryption\necho \"Hello, Vault!\" &gt; test.txt\n\n./bin/file-encryptor encrypt \\\n  -i test.txt \\\n  -o test.txt.enc \\\n  -c configs/examples/example-enterprise.hcl\n\n# Verify files created\nls -la test.txt*\n# Should see: test.txt.enc and test.txt.key\n\n# Decrypt\n./bin/file-encryptor decrypt \\\n  -i test.txt.enc \\\n  -k test.txt.key \\\n  -o test-decrypted.txt \\\n  -c configs/examples/example-enterprise.hcl\n\n# Verify\ndiff test.txt test-decrypted.txt\n# Should be identical\n</code></pre>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#stopping-and-cleaning-up","title":"Stopping and Cleaning Up","text":""},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#stop-services","title":"Stop Services","text":"<pre><code># Stop Vault Agent\npkill -f \"vault agent\"\n\n# Stop Vault server\npkill -f \"vault server\"\n</code></pre>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#clean-up-test-files","title":"Clean Up Test Files","text":"<pre><code># Remove test files\nrm -f test.txt test.txt.enc test.txt.key decrypted.txt\n\n# Remove certificates (to regenerate fresh)\ncd scripts/test-certs\nrm -f ca.crt ca-key.pem client.crt client-key.pem ca.srl\ncd ../..\n</code></pre>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#full-reset","title":"Full Reset","text":"<p>To completely reset and start fresh:</p> <pre><code># Stop all Vault processes\npkill vault\n\n# Remove certificates\ncd scripts/test-certs\nrm -f *.crt *.pem *.srl\ncd ../..\n\n# Start over with step 1\ncd scripts/vault-setup-enterprise\n./01-start-vault-dev.sh\n</code></pre>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#related-guides","title":"Related Guides","text":"<ul> <li>HCP Vault Setup: See VAULT_SETUP_GUIDE.md</li> <li>CLI Usage: See CLI_MODE.md</li> <li>Architecture: See ../ARCHITECTURE.md</li> <li>Windows Users: See VAULT_SETUP_GUIDE_WINDOWS.md</li> </ul>"},{"location":"guides/VAULT_ENTERPRISE_SETUP_GUIDE/#additional-resources","title":"Additional Resources","text":"<ul> <li>Vault Dev Mode</li> <li>Vault Transit Engine</li> <li>Vault Agent</li> <li>Certificate Auth Method</li> <li>Vault Production Hardening</li> <li>Envelope Encryption</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE/","title":"Vault Setup Guide - HCP Vault","text":"<p>Note: This guide is for HCP Vault (cloud-hosted) on Unix, Linux, and macOS platforms. For Windows, see VAULT_SETUP_GUIDE_WINDOWS.md. For Vault Enterprise setup, see VAULT_ENTERPRISE_SETUP_GUIDE.md.</p> <p>This guide walks you through setting up HCP Vault for the file-encryptor application.</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#overview","title":"Overview","text":"<p>The file-encryptor application with HCP Vault uses: - HCP Vault (cloud-hosted) for key management - Vault Transit Engine for envelope encryption - Token Authentication via Vault Agent - Vault Agent as a local proxy with caching</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#prerequisites","title":"Prerequisites","text":"<p>Before starting, ensure you have:</p> <ol> <li>HCP Vault Cluster: Active and accessible</li> <li>Admin Token: With permissions to create policies, mount engines, and configure auth</li> <li>Tools Installed:</li> <li>Terraform 1.5+</li> <li>Vault CLI</li> </ol> <p>Authentication: HCP Vault uses token-based authentication via Vault Agent. Certificate authentication is used for Vault Enterprise (see the Enterprise guide).</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#quick-start","title":"Quick Start","text":""},{"location":"guides/VAULT_SETUP_GUIDE/#1-configure-terraform-variables","title":"1. Configure Terraform Variables","text":"<pre><code>cd scripts/vault-setup\ncp terraform.tfvars.example terraform.tfvars\n</code></pre> <p>Edit <code>terraform.tfvars</code> with your HCP Vault details:</p> <pre><code>vault_address     = \"https://your-vault-cluster.hashicorp.cloud:8200\"\nvault_namespace   = \"admin\"\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE/#2-deploy-vault-configuration","title":"2. Deploy Vault Configuration","text":"<p>Set your Vault credentials:</p> <pre><code>export VAULT_TOKEN=\"your-admin-token\"\nexport VAULT_ADDR=\"https://your-vault-cluster.hashicorp.cloud:8200\"\nexport VAULT_NAMESPACE=\"admin\"\n</code></pre> <p>Initialize and apply Terraform:</p> <pre><code>terraform init\nterraform plan\nterraform apply\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE/#3-verify-configuration","title":"3. Verify Configuration","text":"<pre><code># List transit keys\nvault list transit/keys\n\n# Read encryption key details\nvault read transit/keys/file-encryption-key\n\n# Test data key generation (using your admin token)\nvault write -f transit/datakey/plaintext/file-encryption-key\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE/#4-start-vault-agent","title":"4. Start Vault Agent","text":"<p>Update the Vault address and namespace in <code>configs/vault-agent/vault-agent-hcp-token.hcl</code>, then:</p> <pre><code># Set your Vault token\nexport VAULT_TOKEN=\"your-hcp-admin-token\"\n\n# Start Vault Agent\nvault agent -config=configs/vault-agent/vault-agent-hcp-token.hcl\n</code></pre> <p>Leave this running in a separate terminal. The file-encryptor application will connect to the agent at <code>http://127.0.0.1:8200</code>.</p> <p>Note: For production, use proper token management and consider using HCP Vault's managed authentication methods.</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#what-gets-created","title":"What Gets Created","text":""},{"location":"guides/VAULT_SETUP_GUIDE/#transit-engine","title":"Transit Engine","text":"<ul> <li>Mount Path: <code>transit/</code></li> <li>Key Name: <code>file-encryption-key</code></li> <li>Key Type: AES-256-GCM</li> <li>Configuration: Non-exportable, deletion protection enabled</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE/#vault-policy","title":"Vault Policy","text":"<ul> <li>Name: <code>file-encryptor-policy</code></li> <li>Permissions:</li> <li>[ALLOW] Generate plaintext data keys</li> <li>[ALLOW] Decrypt data keys</li> <li>[ALLOW] Read key metadata</li> <li>[DENY] Direct encrypt/decrypt (enforces envelope encryption)</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE/#architecture","title":"Architecture","text":"<pre><code>graph TD\n    FE[File Encryptor&lt;br/&gt;Application] --&gt;|http://127.0.0.1:8200| VA[Vault Agent&lt;br/&gt;Local Proxy]\n    VA --&gt;|HTTPS + Token| HCP[HCP Vault]\n\n    VA -- Auto-auth with token --&gt; VA\n\n    subgraph HCP Vault\n        HCP\n        TE[Transit Engine]\n        POL[Policies]\n        NS[Namespace]\n\n        HCP --- TE\n        HCP --- POL\n        HCP --- NS\n    end</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE/#security-model","title":"Security Model","text":""},{"location":"guides/VAULT_SETUP_GUIDE/#envelope-encryption-flow","title":"Envelope Encryption Flow","text":"<ol> <li>Application requests plaintext data key from Vault</li> <li>Vault generates random DEK and returns both plaintext and encrypted versions</li> <li>Application encrypts file locally with plaintext DEK (AES-256-GCM)</li> <li>Application saves encrypted DEK to <code>.key</code> file</li> <li>Application zeros plaintext DEK from memory</li> <li>Only encrypted DEK and ciphertext are stored</li> </ol>"},{"location":"guides/VAULT_SETUP_GUIDE/#why-vault-agent","title":"Why Vault Agent?","text":"<ul> <li>Auto-authentication: Automatically renews Vault tokens</li> <li>Caching: Reduces latency and Vault load</li> <li>Simplified config: Application doesn't need cert management</li> <li>Token management: Handles token lifecycle</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE/#production-considerations","title":"Production Considerations","text":""},{"location":"guides/VAULT_SETUP_GUIDE/#1-token-management","title":"1. Token Management","text":"<p>Development (current setup): - Admin token with broad permissions - Token stored in environment variable - Suitable for testing only</p> <p>Production: - Use HCP Vault's managed authentication - Implement token rotation - Follow principle of least privilege - Use short-lived tokens - Consider HCP Vault's identity-based authentication</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#2-key-rotation","title":"2. Key Rotation","text":"<p>Enable automatic key rotation:</p> <pre><code>resource \"vault_transit_secret_backend_key\" \"file_encryption\" {\n  # ... existing config ...\n  auto_rotate_period = 2592000  # 30 days in seconds\n}\n</code></pre> <p>Note: Old versions remain available for decryption.</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#3-high-availability","title":"3. High Availability","text":"<p>HCP Vault provides: - Built-in HA cluster - Automatic failover - Regional redundancy</p> <p>Ensure Vault Agent is configured to handle reconnection.</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#4-monitoring-auditing","title":"4. Monitoring &amp; Auditing","text":"<p>Enable audit logging in Vault:</p> <pre><code>vault audit enable file file_path=/var/log/vault/audit.log\n</code></pre> <p>Monitor: - Key usage patterns - Authentication failures - Rate limiting - Token renewals</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#5-network-security","title":"5. Network Security","text":"<p>Production checklist: - [ ] Secure token storage and rotation - [ ] Firewall rules restricting Vault access - [ ] CIDR restrictions in token policies - [ ] Network segmentation - [ ] Use HCP Vault's private endpoints if available</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/VAULT_SETUP_GUIDE/#token-authentication-fails","title":"Token Authentication Fails","text":"<p>Symptom: <code>permission denied</code> when using token</p> <p>Solutions: 1. Verify token is valid: <code>vault token lookup</code> 2. Check token has required policies 3. Ensure token is not expired 4. Verify namespace is correct (HCP uses <code>admin</code> by default) 5. Check VAULT_TOKEN environment variable is set</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#transit-key-not-found","title":"Transit Key Not Found","text":"<p>Symptom: <code>transit key not found</code></p> <p>Solutions: 1. Check namespace: <code>vault namespace list</code> 2. List keys: <code>vault list transit/keys</code> 3. Verify Terraform applied successfully 4. Check mount path matches config</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#vault-agent-connection-issues","title":"Vault Agent Connection Issues","text":"<p>Symptom: Agent can't connect to HCP Vault</p> <p>Solutions: 1. Verify <code>VAULT_ADDR</code> is correct 2. Check network connectivity: <code>curl -k $VAULT_ADDR/v1/sys/health</code> 3. Verify namespace: HCP uses <code>admin</code> by default 4. Check firewall rules</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#permission-denied-on-operations","title":"Permission Denied on Operations","text":"<p>Symptom: Application can authenticate but operations fail</p> <p>Solutions: 1. Check assigned policies: <code>vault token lookup</code> 2. Verify policy content: <code>vault policy read file-encryptor-policy</code> 3. Test with Vault CLI using same credentials 4. Check path in policy matches mount path</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#testing-the-setup","title":"Testing the Setup","text":""},{"location":"guides/VAULT_SETUP_GUIDE/#manual-test-encryptdecrypt-flow","title":"Manual Test: Encrypt/Decrypt Flow","text":"<pre><code># 1. Set environment variables\nexport VAULT_ADDR=\"https://your-vault-cluster.hashicorp.cloud:8200\"\nexport VAULT_TOKEN=\"your-admin-token\"\nexport VAULT_NAMESPACE=\"admin\"\n\n# 2. Generate data key\nvault write -f transit/datakey/plaintext/file-encryption-key\n\n# Save the output (you'll get plaintext and ciphertext)\n\n# 3. Decrypt the encrypted DEK\nvault write transit/decrypt/file-encryption-key \\\n  ciphertext=\"vault:v1:encrypted_dek_from_above\"\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE/#automated-testing","title":"Automated Testing","text":"<p>The application includes integration tests that verify: - [x] Vault connectivity via Agent - [x] Data key generation - [x] Data key decryption - [x] Policy enforcement - [x] Error handling</p> <p>Run tests: <pre><code>make test-integration\n</code></pre></p>"},{"location":"guides/VAULT_SETUP_GUIDE/#cleanup","title":"Cleanup","text":"<p>To remove all Vault configuration:</p> <pre><code>cd scripts/vault-setup\nterraform destroy\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE/#next-steps","title":"Next Steps","text":"<p>After completing Vault setup:</p> <ol> <li>[DONE] Verify Terraform outputs</li> <li>[DONE] Test certificate authentication</li> <li>[DONE] Confirm Vault Agent is running</li> <li>[DONE] Ready to use the application</li> </ol> <p>Proceed to CLI Usage or Architecture for implementation details.</p>"},{"location":"guides/VAULT_SETUP_GUIDE/#related-guides","title":"Related Guides","text":"<ul> <li>Vault Enterprise Setup: See VAULT_ENTERPRISE_SETUP_GUIDE.md</li> <li>CLI Usage: See CLI_MODE.md</li> <li>Windows Users: See VAULT_SETUP_GUIDE_WINDOWS.md</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE/#additional-resources","title":"Additional Resources","text":"<ul> <li>HCP Vault Documentation</li> <li>Vault Transit Engine</li> <li>Vault Agent</li> <li>Envelope Encryption</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/","title":"Vault Setup Guide - HCP Vault (Windows)","text":"<p>Note: This guide is for HCP Vault (cloud-hosted) on Windows platforms. For Unix/Linux/macOS, see VAULT_SETUP_GUIDE.md.</p> <p>This guide walks you through setting up HCP Vault for the file-encryptor application on Windows.</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#overview","title":"Overview","text":"<p>The file-encryptor application with HCP Vault uses: - HCP Vault (cloud-hosted) for key management - Vault Transit Engine for envelope encryption - Token Authentication via Vault Agent - Vault Agent as a local proxy with caching</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#prerequisites","title":"Prerequisites","text":"<p>Before starting, ensure you have:</p> <ol> <li>HCP Vault Cluster: Active and accessible</li> <li>Admin Token: With permissions to create policies, mount engines, and configure auth</li> <li>Tools Installed:</li> <li>Terraform 1.5+</li> <li>Vault CLI</li> <li>Git for Windows (optional, for Git Bash)</li> </ol> <p>Authentication: HCP Vault uses token-based authentication via Vault Agent. Certificate authentication is used for Vault Enterprise (see the Enterprise guide).</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#installation","title":"Installation","text":""},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#install-terraform","title":"Install Terraform","text":"<pre><code># Using Chocolatey (run as Administrator)\nchoco install terraform\n\n# Or download from: https://www.terraform.io/downloads\n# Extract to C:\\tools\\terraform and add to PATH\n</code></pre> <p>Verify installation: <pre><code>terraform version\n</code></pre></p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#install-vault-cli","title":"Install Vault CLI","text":"<pre><code># Using Chocolatey (run as Administrator)\nchoco install vault\n\n# Or download from: https://www.vaultproject.io/downloads\n# Extract to C:\\tools\\vault and add to PATH\n</code></pre> <p>Verify installation: <pre><code>vault version\n</code></pre></p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#quick-start","title":"Quick Start","text":""},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#1-configure-terraform-variables","title":"1. Configure Terraform Variables","text":"<pre><code>cd scripts\\vault-setup\nCopy-Item terraform.tfvars.example terraform.tfvars\nnotepad terraform.tfvars\n</code></pre> <p>Edit <code>terraform.tfvars</code> with your HCP Vault details:</p> <pre><code>vault_address     = \"https://your-vault-cluster.hashicorp.cloud:8200\"\nvault_namespace   = \"admin\"\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#2-deploy-vault-configuration","title":"2. Deploy Vault Configuration","text":"<p>Set your Vault credentials in PowerShell:</p> <pre><code>$env:VAULT_TOKEN = \"your-admin-token\"\n$env:VAULT_ADDR = \"https://your-vault-cluster.hashicorp.cloud:8200\"\n$env:VAULT_NAMESPACE = \"admin\"\n</code></pre> <p>Initialize and apply Terraform:</p> <pre><code>cd scripts\\vault-setup\nterraform init\nterraform plan\nterraform apply\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#3-verify-configuration","title":"3. Verify Configuration","text":"<pre><code># List transit keys\nvault list transit/keys\n\n# Read encryption key details\nvault read transit/keys/file-encryption-key\n\n# Test data key generation (using your admin token)\nvault write -f transit/datakey/plaintext/file-encryption-key\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#4-start-vault-agent","title":"4. Start Vault Agent","text":"<p>Update the Vault address and namespace in <code>configs\\vault-agent\\vault-agent-hcp-token.hcl</code>, then:</p> <pre><code># Set your Vault token\n$env:VAULT_TOKEN = \"your-hcp-admin-token\"\n\n# Start Vault Agent (keep this running)\nvault agent -config=configs\\vault-agent\\vault-agent-hcp-token.hcl\n</code></pre> <p>Leave this running in a PowerShell window. The file-encryptor application will connect to the agent at <code>http://127.0.0.1:8200</code>.</p> <p>Note: For production, use proper token management and consider using HCP Vault's managed authentication methods.</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#5-test-encryption-new-powershell-window","title":"5. Test Encryption (New PowerShell Window)","text":"<p>Encrypt a file: <pre><code>.\\bin\\file-encryptor-windows-amd64.exe encrypt `\n  -i myfile.txt `\n  -o myfile.txt.enc `\n  -c configs\\examples\\example.hcl\n</code></pre></p> <p>Decrypt a file: <pre><code>.\\bin\\file-encryptor-windows-amd64.exe decrypt `\n  -i myfile.txt.enc `\n  -k myfile.txt.key `\n  -o myfile-decrypted.txt `\n  -c configs\\examples\\example.hcl\n</code></pre></p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#what-gets-created","title":"What Gets Created","text":""},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#transit-engine","title":"Transit Engine","text":"<ul> <li>Mount Path: <code>transit/</code></li> <li>Key Name: <code>file-encryption-key</code></li> <li>Key Type: AES-256-GCM</li> <li>Configuration: Non-exportable, deletion protection enabled</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#vault-policy","title":"Vault Policy","text":"<ul> <li>Name: <code>file-encryptor-policy</code></li> <li>Permissions:</li> <li>[ALLOW] Generate plaintext data keys</li> <li>[ALLOW] Decrypt data keys</li> <li>[ALLOW] Read key metadata</li> <li>[DENY] Direct encrypt/decrypt (enforces envelope encryption)</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#architecture","title":"Architecture","text":"<pre><code>graph TD\n    FE[File Encryptor&lt;br/&gt;Application] --&gt;|http://127.0.0.1:8200| VA[Vault Agent&lt;br/&gt;Local Proxy]\n    VA --&gt;|HTTPS + Token| HCP[HCP Vault]\n\n    VA -- Auto-auth with token --&gt; VA\n\n    subgraph HCP Vault\n        HCP\n        TE[Transit Engine]\n        POL[Policies]\n        NS[Namespace]\n\n        HCP --- TE\n        HCP --- POL\n        HCP --- NS\n    end</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#security-model","title":"Security Model","text":""},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#envelope-encryption-flow","title":"Envelope Encryption Flow","text":"<ol> <li>Application requests plaintext data key from Vault</li> <li>Vault generates random DEK and returns both plaintext and encrypted versions</li> <li>Application encrypts file locally with plaintext DEK (AES-256-GCM)</li> <li>Application saves encrypted DEK to <code>.key</code> file</li> <li>Application zeros plaintext DEK from memory</li> <li>Only encrypted DEK and ciphertext are stored</li> </ol>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#why-vault-agent","title":"Why Vault Agent?","text":"<ul> <li>Auto-authentication: Automatically renews Vault tokens</li> <li>Caching: Reduces latency and Vault load</li> <li>Simplified config: Application doesn't need cert management</li> <li>Token management: Handles token lifecycle</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#windows-specific-configuration","title":"Windows-Specific Configuration","text":""},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#path-separators","title":"Path Separators","text":"<p>Use forward slashes or double backslashes in HCL configuration:</p> <pre><code># Option 1: Forward slashes (recommended)\nencryption {\n  source_dir = \"C:/data/source\"\n  dest_dir = \"C:/data/encrypted\"\n}\n\n# Option 2: Double backslashes\nencryption {\n  source_dir = \"C:\\\\data\\\\source\"\n  dest_dir = \"C:\\\\data\\\\encrypted\"\n}\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#file-permissions","title":"File Permissions","text":"<p>Set restrictive permissions using <code>icacls</code>:</p> <pre><code># Queue state file (read/write by current user only)\nicacls C:\\ProgramData\\file-encryptor\\queue-state.json /inheritance:r /grant:r \"%USERNAME%:(R,W)\"\n\n# Log files (read/write by current user only)\nicacls C:\\ProgramData\\file-encryptor\\logs\\*.log /inheritance:r /grant:r \"%USERNAME%:(R,W)\"\n\n# Key files (read by current user only)\nicacls C:\\data\\encrypted\\*.key /inheritance:r /grant:r \"%USERNAME%:R\"\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#running-as-a-windows-service","title":"Running as a Windows Service","text":"<p>For production, run as a Windows Service using NSSM or WinSW:</p> <p>Using NSSM: <pre><code># Install NSSM\nchoco install nssm\n\n# Install service\nnssm install FileEncryptor \"C:\\Program Files\\file-encryptor\\file-encryptor.exe\"\nnssm set FileEncryptor AppParameters \"watch -c C:\\ProgramData\\file-encryptor\\config.hcl\"\nnssm set FileEncryptor AppDirectory \"C:\\Program Files\\file-encryptor\"\nnssm set FileEncryptor DisplayName \"File Encryptor Service\"\nnssm set FileEncryptor Description \"Watches directories and encrypts files using Vault Transit Engine\"\nnssm set FileEncryptor Start SERVICE_AUTO_START\n\n# Start service\nStart-Service FileEncryptor\n\n# Check status\nGet-Service FileEncryptor\n</code></pre></p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#production-considerations","title":"Production Considerations","text":""},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#1-token-management","title":"1. Token Management","text":"<p>Development (current setup): - Admin token with broad permissions - Token stored in environment variable - Suitable for testing only</p> <p>Production: - Use HCP Vault's managed authentication - Implement token rotation - Follow principle of least privilege - Use short-lived tokens - Consider HCP Vault's identity-based authentication</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#2-key-rotation","title":"2. Key Rotation","text":"<p>Enable automatic key rotation:</p> <pre><code>resource \"vault_transit_secret_backend_key\" \"file_encryption\" {\n  # ... existing config ...\n  auto_rotate_period = 2592000  # 30 days in seconds\n}\n</code></pre> <p>Note: Old versions remain available for decryption.</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#3-high-availability","title":"3. High Availability","text":"<p>HCP Vault provides: - Built-in HA cluster - Automatic failover - Regional redundancy</p> <p>Ensure Vault Agent is configured to handle reconnection.</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#4-monitoring-auditing","title":"4. Monitoring &amp; Auditing","text":"<p>Monitor Vault operations:</p> <pre><code># View Vault Agent logs\nGet-Content C:\\ProgramData\\vault-agent\\agent.log -Wait\n\n# Monitor application logs\nGet-Content C:\\ProgramData\\file-encryptor\\logs\\app.log -Wait\n</code></pre> <p>Enable audit logging in configuration:</p> <pre><code>audit_log {\n  enabled = true\n  path = \"C:/ProgramData/file-encryptor/logs/audit.log\"\n}\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#5-network-security","title":"5. Network Security","text":"<p>Production checklist: - [ ] Secure token storage and rotation - [ ] Windows Firewall rules for Vault Agent - [ ] Use HCP Vault's private endpoints if available - [ ] Enable TLS for all communications - [ ] Implement network segmentation</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#token-authentication-fails","title":"Token Authentication Fails","text":"<p>Symptom: <code>permission denied</code> when using token</p> <p>Solutions: 1. Verify token is valid:    <pre><code>vault token lookup\n</code></pre> 2. Check token has required policies 3. Ensure token is not expired 4. Verify namespace is correct (HCP uses <code>admin</code> by default) 5. Check VAULT_TOKEN environment variable is set:    <pre><code>$env:VAULT_TOKEN\n</code></pre></p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#transit-key-not-found","title":"Transit Key Not Found","text":"<p>Symptom: <code>transit key not found</code></p> <p>Solutions: 1. Check namespace:    <pre><code>vault namespace list\n</code></pre> 2. List keys:    <pre><code>vault list transit/keys\n</code></pre> 3. Verify Terraform applied successfully 4. Check mount path matches config</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#vault-agent-connection-issues","title":"Vault Agent Connection Issues","text":"<p>Symptom: Agent can't connect to HCP Vault</p> <p>Solutions: 1. Verify <code>VAULT_ADDR</code> is correct:    <pre><code>$env:VAULT_ADDR\n</code></pre> 2. Check network connectivity:    <pre><code>Test-NetConnection -ComputerName vault-cluster-xxxxx.hashicorp.cloud -Port 8200\n</code></pre> 3. Verify namespace: HCP uses <code>admin</code> by default 4. Check Windows Firewall:    <pre><code>Get-NetFirewallRule | Where-Object {$_.DisplayName -match \"Vault\"}\n</code></pre></p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#permission-denied-on-operations","title":"Permission Denied on Operations","text":"<p>Symptom: Application can authenticate but operations fail</p> <p>Solutions: 1. Check assigned policies:    <pre><code>vault token lookup\n</code></pre> 2. Verify policy content:    <pre><code>vault policy read file-encryptor-policy\n</code></pre> 3. Test with Vault CLI using same credentials 4. Check path in policy matches mount path</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#path-issues","title":"Path Issues","text":"<p>Symptom: <code>file not found</code> or path errors</p> <p>Solutions: 1. Use absolute paths:    <pre><code>.\\file-encryptor.exe encrypt -i C:\\full\\path\\to\\file.txt -o C:\\output\\file.enc\n</code></pre> 2. Escape backslashes in configuration:    <pre><code>source_dir = \"C:\\\\data\\\\source\"  # or use forward slashes\n</code></pre> 3. Verify directory exists:    <pre><code>Test-Path C:\\data\\source\n</code></pre></p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#testing-the-setup","title":"Testing the Setup","text":""},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#manual-test-encryptdecrypt-flow","title":"Manual Test: Encrypt/Decrypt Flow","text":"<pre><code># 1. Set environment variables\n$env:VAULT_ADDR = \"https://your-vault-cluster.hashicorp.cloud:8200\"\n$env:VAULT_TOKEN = \"your-admin-token\"\n$env:VAULT_NAMESPACE = \"admin\"\n\n# 2. Generate data key\nvault write -f transit/datakey/plaintext/file-encryption-key\n\n# Save the output (you'll get plaintext and ciphertext)\n\n# 3. Decrypt the encrypted DEK\nvault write transit/decrypt/file-encryption-key `\n  ciphertext=\"vault:v1:encrypted_dek_from_above\"\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#powershell-integration-test","title":"PowerShell Integration Test","text":"<pre><code># test-vault-setup.ps1\n$ErrorActionPreference = \"Stop\"\n\nWrite-Host \"Testing Vault setup...\"\n\n# Test connectivity\ntry {\n    $health = vault status\n    Write-Host \"[OK] Vault is accessible\" -ForegroundColor Green\n} catch {\n    Write-Host \"[FAILED] Cannot connect to Vault\" -ForegroundColor Red\n    exit 1\n}\n\n# Test data key generation\ntry {\n    $result = vault write -format=json -f transit/datakey/plaintext/file-encryption-key\n    Write-Host \"[OK] Data key generation successful\" -ForegroundColor Green\n} catch {\n    Write-Host \"[FAILED] Data key generation failed\" -ForegroundColor Red\n    exit 1\n}\n\n# Test encryption\n\"test data\" | Out-File -FilePath test.txt -Encoding ASCII -NoNewline\ntry {\n    &amp; .\\file-encryptor.exe encrypt -i test.txt -o test.enc\n    if ($LASTEXITCODE -eq 0) {\n        Write-Host \"[OK] File encryption successful\" -ForegroundColor Green\n    } else {\n        throw \"Encryption failed\"\n    }\n} catch {\n    Write-Host \"[FAILED] File encryption failed\" -ForegroundColor Red\n    exit 1\n}\n\n# Cleanup\nRemove-Item test.txt, test.enc, test.key -ErrorAction SilentlyContinue\n\nWrite-Host \"[OK] All tests passed\" -ForegroundColor Green\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#cleanup","title":"Cleanup","text":"<p>To remove all Vault configuration:</p> <pre><code>cd scripts\\vault-setup\nterraform destroy\n</code></pre>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#next-steps","title":"Next Steps","text":"<p>After completing Vault setup:</p> <ol> <li>[DONE] Verify Terraform outputs</li> <li>[DONE] Test token authentication</li> <li>[DONE] Confirm Vault Agent is running</li> <li>[DONE] Ready to use the application</li> </ol> <p>Proceed to CLI Usage (Windows) or Architecture for implementation details.</p>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#related-guides","title":"Related Guides","text":"<ul> <li>Unix/Linux/macOS Guide: See VAULT_SETUP_GUIDE.md</li> <li>CLI Usage: See CLI_MODE_WINDOWS.md</li> </ul>"},{"location":"guides/VAULT_SETUP_GUIDE_WINDOWS/#additional-resources","title":"Additional Resources","text":"<ul> <li>HCP Vault Documentation</li> <li>Vault Transit Engine</li> <li>Vault Agent</li> <li>Envelope Encryption</li> <li>Running Windows Services</li> </ul>"}]}